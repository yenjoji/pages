<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Mackerel + Raspberry Pi で 職場環境をモニタリング | Rouleur</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Mackerel + Raspberry Pi で 職場環境をモニタリング
皆さんMackerelをご存知ですか？
Mackerel とは はてな社が提供しているサーバー監視のサービスで、サーバーにエージェントと言われるモジュールを設置するだけで、サーバーの状況がブラウザからグラフィカルに確認できるサービスです。
また、監視ルールを設定しておくことにより、サーバーが特定の状態（CPU使用率90%以">
<meta property="og:type" content="article">
<meta property="og:title" content="Mackerel + Raspberry Pi で 職場環境をモニタリング">
<meta property="og:url" content="http://yenjoji.github.io/pages/2015/07/14/mackerel-raspi-temp/index.html">
<meta property="og:site_name" content="Rouleur">
<meta property="og:description" content="Mackerel + Raspberry Pi で 職場環境をモニタリング
皆さんMackerelをご存知ですか？
Mackerel とは はてな社が提供しているサーバー監視のサービスで、サーバーにエージェントと言われるモジュールを設置するだけで、サーバーの状況がブラウザからグラフィカルに確認できるサービスです。
また、監視ルールを設定しておくことにより、サーバーが特定の状態（CPU使用率90%以">
<meta property="og:image" content="https://farm8.staticflickr.com/7695/17211140511_d168850efd_z.jpg">
<meta property="og:image" content="https://c1.staticflickr.com/1/281/19282373940_5b6feac8f1.jpg">
<meta property="og:image" content="https://c1.staticflickr.com/1/519/19282339528_2010ee2383.jpg">
<meta property="og:image" content="https://c1.staticflickr.com/1/451/19463574002_2b9f7c24ee.jpg">
<meta property="og:image" content="https://c2.staticflickr.com/4/3912/19463581282_0628d1a7f6.jpg">
<meta property="og:image" content="https://c1.staticflickr.com/1/546/18849417353_1ec27ef32a.jpg">
<meta property="og:image" content="https://c1.staticflickr.com/1/432/18849429613_180dececaf.jpg">
<meta property="og:image" content="https://c1.staticflickr.com/1/294/19443993586_0f60c72627.jpg">
<meta property="og:image" content="https://c2.staticflickr.com/4/3707/18849420843_3bd5471118.jpg">
<meta property="og:image" content="https://c1.staticflickr.com/1/488/19443991026_6681b756d0.jpg">
<meta property="og:updated_time" content="2015-08-11T06:02:36.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Mackerel + Raspberry Pi で 職場環境をモニタリング">
<meta name="twitter:description" content="Mackerel + Raspberry Pi で 職場環境をモニタリング
皆さんMackerelをご存知ですか？
Mackerel とは はてな社が提供しているサーバー監視のサービスで、サーバーにエージェントと言われるモジュールを設置するだけで、サーバーの状況がブラウザからグラフィカルに確認できるサービスです。
また、監視ルールを設定しておくことにより、サーバーが特定の状態（CPU使用率90%以">
  
    <link rel="alternative" href="/pages/atom.xml" title="Rouleur" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <!-- <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,600' rel='stylesheet' type='text/css'> -->
  <!-- <link href="//fonts.googleapis.com/css?family=Source+Code+Pro:400,700" rel="stylesheet" type="text/css"> -->
  <link href="//fonts.useso.com/css?family=Source+Code+Pro:400,700" rel="stylesheet" type="text/css">
  <link href='//fonts.useso.com/css?family=Open+Sans:300,600' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="/pages/css/style.css" type="text/css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-30922655-2', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="header-outer" class="outer">
    <a href="/pages/" class="logo">Rouleur</a>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/pages/">Home</a>
        
          <a class="main-nav-link" href="/pages/archives">Archives</a>
        
          <a class="main-nav-link" href="http://about.me/yenjoji">About</a>
        
      </nav>
      <nav id="sub-nav">
        <div id="search-form-wrap">
          <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yenjoji.github.io/pages"></form>
        </div>
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
        
          <a id="nav-rss-link" class="nav-icon" href="/pages/atom.xml" title="RSS Feed"></a>
        
        
          <a id="nav-github-link" class="nav-icon" href="https://github.com/yenjoji" title="Fork me on GitHub"></a>
        
      </nav>
    </div>
  </div>
</header>

      <nav id="mobile-nav" class="off">
  
    <a href="/pages/" class="mobile-nav-link">Home</a>
  
    <a href="/pages/archives" class="mobile-nav-link">Archives</a>
  
    <a href="http://about.me/yenjoji" class="mobile-nav-link">About</a>
  
  <div id="search-form-wrap-mobile">
    <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yenjoji.github.io/pages"></form>
  </div>
</nav>
      <div class="outer">
        
          <aside id="sidebar">
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/pages/2016/03/27/20160327-let-us-construct-himeji-jo_001/">姫路城を作ろう -準備編-</a>
          </li>
        
          <li>
            <a href="/pages/2016/03/11/20160311-read-game-ni-suureba-umakuiku/">「ゲームにすればうまくいく」を読みました</a>
          </li>
        
          <li>
            <a href="/pages/2016/02/27/20160227-read-creative-thinking/">「佐藤可士和のクリエイティブシンキング」を読みました</a>
          </li>
        
          <li>
            <a href="/pages/2016/02/26/20160226-agile-hiyoko/">2016/2/26 アジャイルひよこクラブ 「今年のTryプレゼン＆現場のProblem相談＆Keep事例発表大会」に参加してきました</a>
          </li>
        
          <li>
            <a href="/pages/2016/02/26/20160225-reading-to-tell-the-truth-of-copy/">「ここらで広告コピーの本当の話をします。」を読みました</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/Agile/">Agile</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/Atlassian/">Atlassian</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/Bamboo/">Bamboo</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/CI/">CI</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/Couchbase/">Couchbase</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/Crowd/">Crowd</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/DevLove/">DevLove</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/GlusterFS/">GlusterFS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/Golang/">Golang</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/Groovy/">Groovy</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/IntellijIDEA/">IntellijIDEA</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/IoT/">IoT</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/JJUG/">JJUG</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/Jenkins/">Jenkins</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/Linux/">Linux</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/Mackerel/">Mackerel</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/Pacemaker/">Pacemaker</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/Play/">Play</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/RasperryPi/">RasperryPi</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/S2JDBC/">S2JDBC</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/SVN/">SVN</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/Scala/">Scala</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/Scrum/">Scrum</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/Stash/">Stash</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/Struts/">Struts</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/TOCfE/">TOCfE</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/Windows/">Windows</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/agile/">agile</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/apache/">apache</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/astah/">astah</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/community/">community</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/eclipse/">eclipse</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/english/">english</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/java/">java</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/jiro/">jiro</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/momongar/">momongar</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/mysql/">mysql</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/poem/">poem</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/program/">program</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/reading/">reading</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/scrum/">scrum</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/twitter/">twitter</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/ネタ/">ネタ</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/横浜道場/">横浜道場</a><span class="tag-list-count">2</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/pages/archives/2016/03/">3月 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/pages/archives/2016/02/">2月 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/pages/archives/2016/01/">1月 2016</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/pages/archives/2015/10/">10月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/pages/archives/2015/09/">9月 2015</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/pages/archives/2015/08/">8月 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/pages/archives/2015/07/">7月 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/pages/archives/2015/06/">6月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/pages/archives/2015/04/">4月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/pages/archives/2015/02/">2月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/pages/archives/2013/01/">1月 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/pages/archives/2012/10/">10月 2012</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/pages/archives/2012/07/">7月 2012</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/pages/archives/2012/04/">4月 2012</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/pages/archives/2012/03/">3月 2012</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/pages/archives/2012/01/">1月 2012</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/pages/archives/2011/12/">12月 2011</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/pages/archives/2011/10/">10月 2011</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/pages/archives/2011/07/">7月 2011</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/pages/archives/2011/06/">6月 2011</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/pages/archives/2011/05/">5月 2011</a><span class="archive-list-count">2</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/pages/tags/Agile/" style="font-size: 20px;">Agile</a> <a href="/pages/tags/Atlassian/" style="font-size: 18px;">Atlassian</a> <a href="/pages/tags/Bamboo/" style="font-size: 14px;">Bamboo</a> <a href="/pages/tags/CI/" style="font-size: 12px;">CI</a> <a href="/pages/tags/Couchbase/" style="font-size: 10px;">Couchbase</a> <a href="/pages/tags/Crowd/" style="font-size: 12px;">Crowd</a> <a href="/pages/tags/DevLove/" style="font-size: 10px;">DevLove</a> <a href="/pages/tags/GlusterFS/" style="font-size: 10px;">GlusterFS</a> <a href="/pages/tags/Golang/" style="font-size: 10px;">Golang</a> <a href="/pages/tags/Groovy/" style="font-size: 16px;">Groovy</a> <a href="/pages/tags/IntellijIDEA/" style="font-size: 10px;">IntellijIDEA</a> <a href="/pages/tags/IoT/" style="font-size: 16px;">IoT</a> <a href="/pages/tags/JJUG/" style="font-size: 10px;">JJUG</a> <a href="/pages/tags/Jenkins/" style="font-size: 10px;">Jenkins</a> <a href="/pages/tags/Linux/" style="font-size: 12px;">Linux</a> <a href="/pages/tags/Mackerel/" style="font-size: 10px;">Mackerel</a> <a href="/pages/tags/Pacemaker/" style="font-size: 14px;">Pacemaker</a> <a href="/pages/tags/Play/" style="font-size: 10px;">Play</a> <a href="/pages/tags/RasperryPi/" style="font-size: 12px;">RasperryPi</a> <a href="/pages/tags/S2JDBC/" style="font-size: 10px;">S2JDBC</a> <a href="/pages/tags/SVN/" style="font-size: 10px;">SVN</a> <a href="/pages/tags/Scala/" style="font-size: 10px;">Scala</a> <a href="/pages/tags/Scrum/" style="font-size: 12px;">Scrum</a> <a href="/pages/tags/Stash/" style="font-size: 16px;">Stash</a> <a href="/pages/tags/Struts/" style="font-size: 10px;">Struts</a> <a href="/pages/tags/TOCfE/" style="font-size: 10px;">TOCfE</a> <a href="/pages/tags/Windows/" style="font-size: 10px;">Windows</a> <a href="/pages/tags/agile/" style="font-size: 12px;">agile</a> <a href="/pages/tags/apache/" style="font-size: 10px;">apache</a> <a href="/pages/tags/astah/" style="font-size: 10px;">astah</a> <a href="/pages/tags/community/" style="font-size: 20px;">community</a> <a href="/pages/tags/eclipse/" style="font-size: 10px;">eclipse</a> <a href="/pages/tags/english/" style="font-size: 10px;">english</a> <a href="/pages/tags/java/" style="font-size: 10px;">java</a> <a href="/pages/tags/jiro/" style="font-size: 10px;">jiro</a> <a href="/pages/tags/momongar/" style="font-size: 12px;">momongar</a> <a href="/pages/tags/mysql/" style="font-size: 10px;">mysql</a> <a href="/pages/tags/poem/" style="font-size: 10px;">poem</a> <a href="/pages/tags/program/" style="font-size: 10px;">program</a> <a href="/pages/tags/reading/" style="font-size: 20px;">reading</a> <a href="/pages/tags/scrum/" style="font-size: 12px;">scrum</a> <a href="/pages/tags/twitter/" style="font-size: 10px;">twitter</a> <a href="/pages/tags/ネタ/" style="font-size: 12px;">ネタ</a> <a href="/pages/tags/横浜道場/" style="font-size: 12px;">横浜道場</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">links</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="http://about.me/yenjoji">about.me</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
        <section id="main"><article id="post-mackerel-raspi-temp" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/pages/2015/07/14/mackerel-raspi-temp/" class="article-date">
  <time datetime="2015-07-14T12:49:44.000Z" itemprop="datePublished">2015-07-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Mackerel + Raspberry Pi で 職場環境をモニタリング
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Mackerel + Raspberry Pi で 職場環境をモニタリング</p>
<p>皆さんMackerelをご存知ですか？</p>
<p><a href="https://mackerel.io" target="_blank" rel="external">Mackerel</a> とは はてな社が提供しているサーバー監視のサービスで、<br>サーバーにエージェントと言われるモジュールを設置するだけで、サーバーの状況がブラウザからグラフィカルに確認できるサービスです。</p>
<p>また、監視ルールを設定しておくことにより、サーバーが特定の状態（CPU使用率90%以上など）になった場合アラートを通知したり<br>無料プランでも一部制限はありますが、サーバー5台まで監視可能など、お手軽、便利、太っ腹なサービスです。</p>
<p>今回は、そんな本来はサーバー監視のサービスであるMackerelを本来の用途以外に使ってみようと思います。</p>
<h1 id="突然ですが、夏ですね">突然ですが、夏ですね</h1><p>だんだん気候も夏めいて来た今日このごろ、やはり気になるのはオフィスの環境。<br>健康を害するような環境で仕事をしないためにも、暑さで仕事の効率が落ちないためにも職場環境には気を使いたいところです。</p>
<p>というわけで、今回は職場（でなくてもいいですが）の温度と湿度を計測したいと思います。</p>
<h1 id="温度・湿度を測定する">温度・湿度を測定する</h1><p>では、実際に監視システムを構築していきたいと思います。</p>
<h2 id="今回使うもの">今回使うもの</h2><ul>
<li>Raspberry pi 2 Type B</li>
<li>温湿度センサー<ul>
<li>今回はAM2320 <a href="http://akizukidenshi.com/catalog/g/gM-08663/" target="_blank" rel="external">http://akizukidenshi.com/catalog/g/gM-08663/</a> を使用しました。</li>
</ul>
</li>
<li>Raspberry pi と 温度センサー接続用のブレッドボードやジャンパ線<ul>
<li>温度センサーとRaspberry Pi をつなぐための線を必要な分用意します。</li>
</ul>
</li>
<li>以前に使用したズゴック（オプション）</li>
</ul>
<h2 id="ハードウェアの準備">ハードウェアの準備</h2><h3 id="Raspberry_Pi_と_AM2320_を接続する">Raspberry Pi と AM2320 を接続する</h3><p>この実体配線図のようにAM2320をRaspberry Pi と接続します。<br>AM2320は型番のシルク印刷を表に見た場合、<br>左から</p>
<ul>
<li>VDD &lt;-&gt; Pin #2 5V</li>
<li>SDA &lt;-&gt; Pin #3 SDA</li>
<li>GND &lt;-&gt; Pin #20 等 GND</li>
<li>SCL &lt;-&gt; Pin #5 SCL<br>と接続します。</li>
</ul>
<p><a href="https://www.flickr.com/photos/130999506@N07/17211140511" title="raspi_am2320 by Yasuto Enjoji, on Flickr" target="_blank" rel="external"><img src="https://farm8.staticflickr.com/7695/17211140511_d168850efd_z.jpg" width="640" height="479" alt="raspi_am2320"></a></p>
<h2 id="ソフトウエアの準備">ソフトウエアの準備</h2><h3 id="Raspberry_Pi_で_I2C_を使えるようにする">Raspberry Pi で I2C を使えるようにする</h3><p>今回使用する AM2320 という温湿度計モジュールは I2C インターフェース経由でデータを取得します。<br>RaspberryPIは初期状態ではI2Cが有効になっていないため、<br>こちらのページ <a href="https://blog.ymyzk.com/2015/02/enable-raspberry-pi-i2c/" target="_blank" rel="external">https://blog.ymyzk.com/2015/02/enable-raspberry-pi-i2c/</a> を参考にし、I2Cを有効にします。</p>
<h3 id="AM2320からデータを取得するプログラムを用意する">AM2320からデータを取得するプログラムを用意する</h3><p>こちらのコード <a href="https://github.com/takagi/am2321" target="_blank" rel="external">https://github.com/takagi/am2321</a> をベースにし、出力をMackerelに対応させたコードがこちらです。</p>
<div class=""><br>  <script src="https://gist.github.com/yenjoji/40d135519a0741d3718b.js"></script><br></div>

<p>これをRaspberryPI上でコンパイルし、パスの通った場所に配置します。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -LO https://gist.githubusercontent.com/yenjoji/40d135519a0741d3718b/raw/5c7835651a539f16f3446108e15aa482f6c2111f/am2321.c&#10;&#10;gcc -lm -o am2321 am2321.c&#10;&#10;chmod a+x am2321&#10;mv am2321 /usr/local/bin</span><br></pre></td></tr></table></figure>
<h1 id="Mackerelとの連携">Mackerelとの連携</h1><h2 id="Mackerelに登録してオーガニゼーションを作成する">Mackerelに登録してオーガニゼーションを作成する</h2><p><a href="http://help-ja.mackerel.io/entry/getting-started" target="_blank" rel="external">http://help-ja.mackerel.io/entry/getting-started</a><br>の手順にそって、オーガニゼーションを作成します。</p>
<h2 id="maeckrel-agent_をインストールする">maeckrel-agent をインストールする</h2><p>パッケージをダウンロードし、インストールします。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -LO http://file.mackerel.io/agent/deb/mackerel-agent_latest.all.deb&#10;sudo dpkg -i mackerel-agent_latest.all.deb</span><br></pre></td></tr></table></figure>
<h2 id="ARM_版バイナリに実行ファイルを置き換える">ARM 版バイナリに実行ファイルを置き換える</h2><p>通常ならば、パッケージをインストールすれば完了ですが、<br>RasperryPiはもともとMackerelが想定しているCPUとアーキテクチャが違うためかそのままではうまく起動しません。<br>そのため、RaspberryPiのCPUにあったアーキテクチャのMackerelの実行ファイルで上書きします。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -LO https://github.com/mackerelio/mackerel-agent/releases/download/v0.17.1/mackerel-agent_linux_arm.tar.gz&#10;tar xf mackerel-agent_linux_arm.tar.gz&#10;&#10;sudo mv /usr/local/bin/mackerel-agent /usr/local/bin/mackerel-agent.org&#10;sudo mv mackerel-agent_linux_arm/mackerel-agent /usr/local/bin/mackerel-agent</span><br></pre></td></tr></table></figure>
<h2 id="maeckrel-agentの設定">maeckrel-agentの設定</h2><p>インストールが完了したので、設定をしていきます。</p>
<p>設定ファイルに apiKeyとカスタムメトリクスの設定を追加します。<br>/etc/mackerel-agent/mackerel-agent.conf に オーガニゼーションの画面に表示されているAPIKEYと<br>以下のカスタムメトリクスの設定を追加してください。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># Get room status&#10;[plugin.metrics.temperature]&#10;command = &#34;/usr/local/bin/am2321 -m&#34;</span><br></pre></td></tr></table></figure>
<h2 id="mackerel-agent_起動">mackerel-agent 起動</h2><p>以上で設定がひと通り完了しましたので、エージェントを起動します。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo /etc/init.d/mackerel-agent start</span><br></pre></td></tr></table></figure>
<p>これで、先ほど作成したオーガニゼーションに自動的にホストが追加され、<br>mackerelのデフォルトの監視項目と、温湿度計のデータが記録されていくようになります。</p>
<p><a data-flickr-embed="true" href="https://www.flickr.com/photos/130999506@N07/19282373940/in/dateposted-public/" title="mackerel-room" target="_blank" rel="external"><img src="https://c1.staticflickr.com/1/281/19282373940_5b6feac8f1.jpg" width="500" height="333" alt="mackerel-room"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></p>
<h1 id="アラートの設定">アラートの設定</h1><p>無事に温度と湿度の記録が始まりました。<br>しかしながらこれだけでは、職場が危機な状況になっても気づくことが出来ません。</p>
<p>ということで、職場の労働環境を監視する尺度として、不快指数を使って職場環境をモニタリングしたいと思います。</p>
<p>実は先程のMackerelカスタムメトリクス取得プログラムには、温度、湿度以外に不快指数も取得できるようにしてあります。<br>なので、手順通りに設定した場合は、すでにカスタムメトリクス上に不快指数が記録されていると思います。</p>
<p>wikipediaによると、日本人は不快指数が77を超えた辺りから一部の方々が不快を覚え始め、80を超えるとみんなが不快感を感じるそうなので、<br>この値を超えた場合に通知が来るように設定したいと思います。</p>
<ol>
<li>Macerel管理画面から Monitor メニューをクリックし、監視ルールを追加ボタンをクリックします。<br><a data-flickr-embed="true" href="https://www.flickr.com/photos/130999506@N07/19282339528/in/dateposted-public/" title="mackerel-monitor_001" target="_blank" rel="external"><img src="https://c1.staticflickr.com/1/519/19282339528_2010ee2383.jpg" width="500" height="263" alt="mackerel-monitor_001"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></li>
<li>ポップアップしたウィンドウに監視条件を入力し作成ボタンをクリックします。<br>今回は不快指数(custom.room.1.discomfortindex)を選択し、77でWarning、80でCriticalとなるように設定します。<br><a data-flickr-embed="true" href="https://www.flickr.com/photos/130999506@N07/19463574002/in/dateposted-public/" title="mackerel-monitor_002" target="_blank" rel="external"><img src="https://c1.staticflickr.com/1/451/19463574002_2b9f7c24ee.jpg" width="500" height="263" alt="mackerel-monitor_002"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></li>
<li>作成した関し条件が一覧に表示されていれば成功です。<br>これで不快指数がしきい値を超えるた際にメール通知がされるようになりました。また、チャットなどメール以外の通知方法も用意されています。（私はHipChatにも通知しています。）<br><a data-flickr-embed="true" href="https://www.flickr.com/photos/130999506@N07/19463581282/in/dateposted-public/" title="momongar-discomfortindex" target="_blank" rel="external"><img src="https://c2.staticflickr.com/4/3912/19463581282_0628d1a7f6.jpg" width="500" height="260" alt="momongar-discomfortindex"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></li>
</ol>
<h1 id="ズゴックと連携する">ズゴックと連携する</h1><p>以前作成した、ズゴックXFDですが、<br>チームのみんながちゃんとテストが通ることを確認してからソースコードをPushするため、ほぼ活躍する機会がありません。<br>このままだと <strong>ただ職場にガンプラをおいている人になってしまう</strong> ので、<br>ズゴックの存在意義を上げるべく温度計を連携させたいと思います。</p>
<h2 id="温度計の実装">温度計の実装</h2><ol>
<li>ドリルで大まかな穴を開けた後、ニッパーで穴をつなぎ<br><a data-flickr-embed="true" href="https://www.flickr.com/photos/130999506@N07/18849417353/in/dateposted-public/" title="DSC_0093" target="_blank" rel="external"><img src="https://c1.staticflickr.com/1/546/18849417353_1ec27ef32a.jpg" width="500" height="281" alt="DSC_0093"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></li>
<li>カッターで凹凸を整えます<br><a data-flickr-embed="true" href="https://www.flickr.com/photos/130999506@N07/18849429613/in/dateposted-public/" title="DSC_0094" target="_blank" rel="external"><img src="https://c1.staticflickr.com/1/432/18849429613_180dececaf.jpg" width="500" height="281" alt="DSC_0094"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></li>
<li>温度計を開けた穴にはめ込み、配線を足経由で踵から外部に引き出せば完成です。<br><a data-flickr-embed="true" href="https://www.flickr.com/photos/130999506@N07/19443993586/in/dateposted-public/" title="DSC_0101" target="_blank" rel="external"><img src="https://c1.staticflickr.com/1/294/19443993586_0f60c72627.jpg" width="281" height="500" alt="DSC_0101"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></li>
<li>組み立てるとこんなかんじになります。<br><a data-flickr-embed="true" href="https://www.flickr.com/photos/130999506@N07/18849420843/in/dateposted-public/" title="DSC_0108" target="_blank" rel="external"><img src="https://c2.staticflickr.com/4/3707/18849420843_3bd5471118.jpg" width="500" height="281" alt="DSC_0108"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script><br><a data-flickr-embed="true" href="https://www.flickr.com/photos/130999506@N07/19443991026/in/dateposted-public/" title="DSC_0105" target="_blank" rel="external"><img src="https://c1.staticflickr.com/1/488/19443991026_6681b756d0.jpg" width="281" height="500" alt="DSC_0105"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></li>
</ol>
<h1 id="結果">結果</h1><p>晴れてズゴックに温度計が付き、職場の状況をモニタリングすることが可能になりました。</p>
<p>これで、自分の居室の不快指数を計測し放題です。<br>計測したところで、特に快適になったりはしないのは残念ですが、<br>計測データを元に現場のリーダーに職場環境のカイゼンをお願いする材料くらいにはなるはずです。</p>
<p>ただ、残念ながら、温度計を付けてもズゴック見た目に変化がないので、<br>相変わらず傍から見るとガンダム好きな人にしか見えないという点は今後の課題とします。</p>
<p>みなさんもMackerelと様々なセンサーを組み合わせて遊んでみるのはいかがでしょうか？</p>
<h1 id="参考URL">参考URL</h1><h2 id="Raspberry_Pi_の_I2C_を有効化する方法_(2015年版)">Raspberry Pi の I2C を有効化する方法 (2015年版)</h2><p><a href="https://blog.ymyzk.com/2015/02/enable-raspberry-pi-i2c/" target="_blank" rel="external">https://blog.ymyzk.com/2015/02/enable-raspberry-pi-i2c/</a></p>
<h2 id="Raspberry_Pi_で湿度センサ_AM2321_を使う">Raspberry Pi で湿度センサ AM2321 を使う</h2><p><a href="http://technology-memo.seesaa.net/article/404719464.html" target="_blank" rel="external">http://technology-memo.seesaa.net/article/404719464.html</a></p>
<h2 id="Mackerelについて">Mackerelについて</h2><p><a href="http://qiita.com/ariarijp/items/838628e121b051524309" target="_blank" rel="external">http://qiita.com/ariarijp/items/838628e121b051524309</a></p>
<h2 id="不快指数">不快指数</h2><p><a href="https://ja.wikipedia.org/wiki/%E4%B8%8D%E5%BF%AB%E6%8C%87%E6%95%B0" target="_blank" rel="external">https://ja.wikipedia.org/wiki/%E4%B8%8D%E5%BF%AB%E6%8C%87%E6%95%B0</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yenjoji.github.io/pages/2015/07/14/mackerel-raspi-temp/" data-id="cim9ypa2o001nkgvxsofkpt62" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/pages/tags/IoT/">IoT</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/pages/tags/Mackerel/">Mackerel</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/pages/tags/RasperryPi/">RasperryPi</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/pages/tags/ネタ/">ネタ</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/pages/2015/07/23/getting-start-play-with-idea/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Play! Scalaを Macで始める
        
      </div>
    </a>
  
  
    <a href="/pages/2015/06/22/20150621-spoken-at-asbc-tdd/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">2015/6/21 Agilesamurai Basecamp ふりかえり &amp; TDD でお話させていただきました。</div>
    </a>
  
</nav>

  
</article>

</section>
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      <a href="/" class="logo">Rouleur</a>
      &copy; 2016 yenjoji<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    

<script src="/pages/js/jquery.min.js" type="text/javascript"></script>
<script src="/pages/js/jquery.scrollLoading.js" type="text/javascript"></script>


  <link rel="stylesheet" href="/pages/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/pages/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/pages/js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>