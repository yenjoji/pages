<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Rouleur</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Rouleur">
<meta property="og:url" content="http://yenjoji.github.io/pages/page/4/index.html">
<meta property="og:site_name" content="Rouleur">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Rouleur">
  
    <link rel="alternative" href="/pages/atom.xml" title="Rouleur" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <!-- <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,600' rel='stylesheet' type='text/css'> -->
  <!-- <link href="//fonts.googleapis.com/css?family=Source+Code+Pro:400,700" rel="stylesheet" type="text/css"> -->
  <link href="//fonts.useso.com/css?family=Source+Code+Pro:400,700" rel="stylesheet" type="text/css">
  <link href='//fonts.useso.com/css?family=Open+Sans:300,600' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="/pages/css/style.css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-30922655-2', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="header-outer" class="outer">
    <a href="/pages/pages/" class="logo">Rouleur</a>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/pages/pages/">Home</a>
        
          <a class="main-nav-link" href="/pages/pages/archives">Archives</a>
        
          <a class="main-nav-link" href="http://about.me/yenjoji">About</a>
        
      </nav>
      <nav id="sub-nav">
        <div id="search-form-wrap">
          <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yenjoji.github.io/pages"></form>
        </div>
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
        
          <a id="nav-rss-link" class="nav-icon" href="/pages/atom.xml" title="RSS Feed"></a>
        
        
          <a id="nav-github-link" class="nav-icon" href="https://github.com/yenjoji" title="Fork me on GitHub"></a>
        
      </nav>
    </div>
  </div>
</header>

      <nav id="mobile-nav" class="off">
  
    <a href="/pages/pages/" class="mobile-nav-link">Home</a>
  
    <a href="/pages/pages/archives" class="mobile-nav-link">Archives</a>
  
    <a href="http://about.me/yenjoji" class="mobile-nav-link">About</a>
  
  <div id="search-form-wrap-mobile">
    <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yenjoji.github.io/pages"></form>
  </div>
</nav>
      <div class="outer">
        
          <aside id="sidebar">
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/pages/2016/12/17/20161217-jirolian-info/">jirolian.info というサービスをつくりました</a>
          </li>
        
          <li>
            <a href="/pages/2016/11/08/20161108-teyamagu/">ソフトウェア品質勉強会「開発とテストが一体となったソフトウェア開発」</a>
          </li>
        
          <li>
            <a href="/pages/2016/10/21/20161021-apache-drill/">Apache DrillでJSONを臨機応変に集計する</a>
          </li>
        
          <li>
            <a href="/pages/2016/07/26/20160725-ecr-101/">Amazon ECR が思った以上に簡単だったのでDocker Private Registry はコレでいいんじゃないか</a>
          </li>
        
          <li>
            <a href="/pages/2016/06/26/20160626-nu-board/">ヌーボードは作れる！？</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/AWS/">AWS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/Agile/">Agile</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/Atlassian/">Atlassian</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/Bamboo/">Bamboo</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/CI/">CI</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/Couchbase/">Couchbase</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/Crowd/">Crowd</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/DevLove/">DevLove</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/ECR/">ECR</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/GlusterFS/">GlusterFS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/Golang/">Golang</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/Groovy/">Groovy</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/IntellijIDEA/">IntellijIDEA</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/IoT/">IoT</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/JJUG/">JJUG</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/JSON/">JSON</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/Jenkins/">Jenkins</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/Linux/">Linux</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/Mackerel/">Mackerel</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/Pacemaker/">Pacemaker</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/Play/">Play</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/RasperryPi/">RasperryPi</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/S2JDBC/">S2JDBC</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/SVN/">SVN</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/Scala/">Scala</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/Scrum/">Scrum</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/Stash/">Stash</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/Struts/">Struts</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/TOCfE/">TOCfE</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/Windows/">Windows</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/agile/">agile</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/apache/">apache</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/astah/">astah</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/community/">community</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/docker/">docker</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/drill/">drill</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/eclipse/">eclipse</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/english/">english</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/java/">java</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/jiro/">jiro</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/lifehack/">lifehack</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/momongar/">momongar</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/mysql/">mysql</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/poem/">poem</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/program/">program</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/reading/">reading</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/scrum/">scrum</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/twitter/">twitter</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/ネタ/">ネタ</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/pages/tags/横浜道場/">横浜道場</a><span class="tag-list-count">2</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/pages/archives/2016/12/">12月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/pages/archives/2016/11/">11月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/pages/archives/2016/10/">10月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/pages/archives/2016/07/">7月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/pages/archives/2016/06/">6月 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/pages/archives/2016/05/">5月 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/pages/archives/2016/04/">4月 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/pages/archives/2016/03/">3月 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/pages/archives/2016/02/">2月 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/pages/archives/2016/01/">1月 2016</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/pages/archives/2015/10/">10月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/pages/archives/2015/09/">9月 2015</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/pages/archives/2015/08/">8月 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/pages/archives/2015/07/">7月 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/pages/archives/2015/06/">6月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/pages/archives/2015/04/">4月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/pages/archives/2015/02/">2月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/pages/archives/2013/01/">1月 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/pages/archives/2012/10/">10月 2012</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/pages/archives/2012/07/">7月 2012</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/pages/archives/2012/04/">4月 2012</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/pages/archives/2012/03/">3月 2012</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/pages/archives/2012/01/">1月 2012</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/pages/archives/2011/12/">12月 2011</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/pages/archives/2011/10/">10月 2011</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/pages/archives/2011/07/">7月 2011</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/pages/archives/2011/06/">6月 2011</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/pages/archives/2011/05/">5月 2011</a><span class="archive-list-count">2</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/pages/tags/AWS/" style="font-size: 10px;">AWS</a> <a href="/pages/tags/Agile/" style="font-size: 18.89px;">Agile</a> <a href="/pages/tags/Atlassian/" style="font-size: 16.67px;">Atlassian</a> <a href="/pages/tags/Bamboo/" style="font-size: 12.22px;">Bamboo</a> <a href="/pages/tags/CI/" style="font-size: 11.11px;">CI</a> <a href="/pages/tags/Couchbase/" style="font-size: 10px;">Couchbase</a> <a href="/pages/tags/Crowd/" style="font-size: 11.11px;">Crowd</a> <a href="/pages/tags/DevLove/" style="font-size: 10px;">DevLove</a> <a href="/pages/tags/ECR/" style="font-size: 10px;">ECR</a> <a href="/pages/tags/GlusterFS/" style="font-size: 10px;">GlusterFS</a> <a href="/pages/tags/Golang/" style="font-size: 10px;">Golang</a> <a href="/pages/tags/Groovy/" style="font-size: 14.44px;">Groovy</a> <a href="/pages/tags/IntellijIDEA/" style="font-size: 10px;">IntellijIDEA</a> <a href="/pages/tags/IoT/" style="font-size: 15.56px;">IoT</a> <a href="/pages/tags/JJUG/" style="font-size: 10px;">JJUG</a> <a href="/pages/tags/JSON/" style="font-size: 10px;">JSON</a> <a href="/pages/tags/Jenkins/" style="font-size: 10px;">Jenkins</a> <a href="/pages/tags/Linux/" style="font-size: 11.11px;">Linux</a> <a href="/pages/tags/Mackerel/" style="font-size: 10px;">Mackerel</a> <a href="/pages/tags/Pacemaker/" style="font-size: 12.22px;">Pacemaker</a> <a href="/pages/tags/Play/" style="font-size: 10px;">Play</a> <a href="/pages/tags/RasperryPi/" style="font-size: 11.11px;">RasperryPi</a> <a href="/pages/tags/S2JDBC/" style="font-size: 10px;">S2JDBC</a> <a href="/pages/tags/SVN/" style="font-size: 10px;">SVN</a> <a href="/pages/tags/Scala/" style="font-size: 10px;">Scala</a> <a href="/pages/tags/Scrum/" style="font-size: 12.22px;">Scrum</a> <a href="/pages/tags/Stash/" style="font-size: 14.44px;">Stash</a> <a href="/pages/tags/Struts/" style="font-size: 10px;">Struts</a> <a href="/pages/tags/TOCfE/" style="font-size: 10px;">TOCfE</a> <a href="/pages/tags/Windows/" style="font-size: 10px;">Windows</a> <a href="/pages/tags/agile/" style="font-size: 13.33px;">agile</a> <a href="/pages/tags/apache/" style="font-size: 10px;">apache</a> <a href="/pages/tags/astah/" style="font-size: 10px;">astah</a> <a href="/pages/tags/community/" style="font-size: 17.78px;">community</a> <a href="/pages/tags/docker/" style="font-size: 11.11px;">docker</a> <a href="/pages/tags/drill/" style="font-size: 10px;">drill</a> <a href="/pages/tags/eclipse/" style="font-size: 10px;">eclipse</a> <a href="/pages/tags/english/" style="font-size: 10px;">english</a> <a href="/pages/tags/java/" style="font-size: 10px;">java</a> <a href="/pages/tags/jiro/" style="font-size: 11.11px;">jiro</a> <a href="/pages/tags/lifehack/" style="font-size: 10px;">lifehack</a> <a href="/pages/tags/momongar/" style="font-size: 11.11px;">momongar</a> <a href="/pages/tags/mysql/" style="font-size: 10px;">mysql</a> <a href="/pages/tags/poem/" style="font-size: 10px;">poem</a> <a href="/pages/tags/program/" style="font-size: 10px;">program</a> <a href="/pages/tags/reading/" style="font-size: 20px;">reading</a> <a href="/pages/tags/scrum/" style="font-size: 11.11px;">scrum</a> <a href="/pages/tags/twitter/" style="font-size: 10px;">twitter</a> <a href="/pages/tags/ネタ/" style="font-size: 11.11px;">ネタ</a> <a href="/pages/tags/横浜道場/" style="font-size: 11.11px;">横浜道場</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">links</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="http://about.me/yenjoji">about.me</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
        <section id="main">
  
    <article id="post-setup-stash-ha" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/pages/2015/09/15/setup-stash-ha/" class="article-date">
  <time datetime="2015-09-15T03:10:00.000Z" itemprop="datePublished">2015-09-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/pages/2015/09/15/setup-stash-ha/">Atlassian Stashの耐障害性を高めよう その2 HAセットアップ編</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>今回は <a href="http://yenjoji.github.io/pages/2015/09/08/stash-ha-101/">前回 「Atlassian Stashの耐障害性を高めよう その１ プランニング編」</a> の続きとして、<br>HAクラスタのセットアップを行いたいと思います。</p>
<p>手順は<a href="https://access.redhat.com/documentation/ja-JP/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/" target="_blank" rel="external">redhat向けのHIGH AVAILABILITY ADD-ON リファレンス</a> を参考に行っていきます</p>
<h1 id="今回の構成">今回の構成</h1><p>今回は、LinuxのHAクラスタミドルウェアの定番であるPacemakerを使用してクラスタを構成します。</p>
<table>
<thead>
<tr>
<th>ソフトウェア</th>
<th>バージョン</th>
</tr>
</thead>
<tbody>
<tr>
<td>CentOS</td>
<td>7.1</td>
</tr>
<tr>
<td>Pacemaker</td>
<td>1.1.12</td>
</tr>
<tr>
<td>Corosync</td>
<td>2.3.4</td>
</tr>
<tr>
<td>pcs</td>
<td>0.9.137</td>
</tr>
</tbody>
</table>
<p>ノード設定<br>|ホスト名|IP|備考|<br>|—|—|—|<br>|node01|192,168.33.21|Stash node #1|<br>|node02|192,168.33.22|Stash node #2|<br>|stash|192,168.33.101|Stash VIP|</p>
<h1 id="事前準備">事前準備</h1><p>クラスタ構成の際にお互いのノード名を解決出来ないとイケないので、 /etc/hosts にホストを追加しておきます。</p>
<p>/etc/hosts<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">192.168.33.21 node01</div><div class="line">192.168.33.22 node02</div></pre></td></tr></table></figure></p>
<p>次にクラスタの通信に使用するポートを開放します<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">firewall-cmd --permanent --add-service=high-availability</div><div class="line">firewall-cmd --add-service=high-availability</div></pre></td></tr></table></figure></p>
<h1 id="ソフトウェアのインストール">ソフトウェアのインストール</h1><p>それでは、必要なソフトウェアをインストールしていきます。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># yum install pcs fence-agents-all</div></pre></td></tr></table></figure></p>
<p>コマンドを両方のノードで実行します。<br>これだけでHAクラスタに必要なソフト一式がインストールされます。</p>
<p>インストールが無事完了したら、クラスタの構成を行うコマンドのデーモンである pcsd を起動します。<br><br><br>また、再起動時に自動的に起動するように設定します。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">systemctl start pcsd</div><div class="line">systemctl enable pcsd</div></pre></td></tr></table></figure></p>
<h1 id="クラスタの構築">クラスタの構築</h1><p>次に、node01,node02をメンバーとして、HAクラスタを構築します。</p>
<h2 id="hacluster_ユーザーのパスワードを設定">hacluster ユーザーのパスワードを設定</h2><p>ここでは、マニュアルの推奨に従って、両ノードともに同じパスワードを設定します。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">passwd hacluster</div></pre></td></tr></table></figure></p>
<p>これも両ノードで実行します。</p>
<h2 id="クラスタノードの認証">クラスタノードの認証</h2><p>クラスタノード間の認証設定をします。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pcs cluster auth node01 node02 -u hacluster -p hacluster</div></pre></td></tr></table></figure></p>
<h2 id="クラスタの作成">クラスタの作成</h2><p>クラスタを作成します<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pcs cluster setup --start --name stash node01 node02</div></pre></td></tr></table></figure></p>
<h2 id="クラスタ状態の確認">クラスタ状態の確認</h2><p>作成したクラスタの状況を確認します。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pcs cluster status</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">Cluster Status:</div><div class="line"> Last updated: Mon Sep 14 09:46:54 2015		Last change: Mon Sep 14 09:42:40 2015 by hacluster via crmd on node02</div><div class="line"> Stack: corosync</div><div class="line"> Current DC: node02 (version 1.1.13-a14efad) - partition with quorum</div><div class="line"> 2 nodes and 0 resources configured</div><div class="line"> Online: [ node01 node02 ]</div><div class="line"></div><div class="line">PCSD Status:</div><div class="line">  node01: Online</div><div class="line">  node02: Online</div></pre></td></tr></table></figure>
<p>両ノードがOnlineとなっていればOKです。</p>
<h2 id="STONITH_の無効化">STONITH の無効化</h2><p>ここで、/var/log/messages を確認すると。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Sep 14 11:16:14 localhost pengine[4158]: error: Resource start-up disabled since no STONITH resources</div><div class="line">have been defined</div><div class="line">Sep 14 11:16:14 localhost pengine[4158]: error: Either configure some or disable STONITH with the ston</div><div class="line">ith-enabled option</div><div class="line">Sep 14 11:16:14 localhost pengine[4158]: error: NOTE: Clusters with shared data need STONITH to ensure</div><div class="line"> data integrity</div></pre></td></tr></table></figure>
<p>といったエラーが発生しています。</p>
<p>この<a href="http://kan3aa.hatenablog.com/entry/2015/06/05/135150" target="_blank" rel="external">ページ</a>によると</p>
<p>STONITHと呼ばれるノードが不安定になった場合、自動的に再起動を行う機能を実現するためのリソースが無いためエラーとなってしまっているようです。<br><br>現時点ではSTONITHを使用しないため、<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pcs property set stonith-enabled=false</div></pre></td></tr></table></figure></p>
<p>を実行し、機能を無効化します。</p>
<h1 id="リソースの作成">リソースの作成</h1><p>クラスタの設定が終わったところで、次にリソースを設定します。<br>クラスタでのリソースとは特にクラスタノード間で共有するリソースのことを指します。例えばアクティブノードが使用する仮想IPなどです。</p>
<p>今回は、ユーザーがアクセスする際に指定する、サービス用の仮想IPをリソースとして追加します。</p>
<p>どちらかのノードでコマンドを実行します。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pcs resource create stash_vip IPaddr2 ip=192.168.33.101 cidr_netmask=24 op monitor interval=6s</div></pre></td></tr></table></figure></p>
<p>これで、6秒ごとに死活確認を行うIPアドレスの共有リソースが設定されました。<br>アクティブノードに 192.168.33.101 のIPエイリアスが設定される様になります。</p>
<h1 id="ノード切り替えのテスト">ノード切り替えのテスト</h1><p>サービス用の仮想IPが割り当てられることが確認出来ました。</p>
<h2 id="アクティブノードの障害">アクティブノードの障害</h2><p>アクティブノードの障害時に正常に切り替わるか確認してみましょう。</p>
<p>Active : node01<br>Standby: node02</p>
<p>の状態で、node01の電源をOFFしてみます。</p>
<p>実施前<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"># pcs status</div><div class="line">Cluster name: stash</div><div class="line">Last updated: Mon Sep 14 12:14:31 2015		Last change: Mon Sep 14 11:51:35 2015 by root via crm_attribute on node02</div><div class="line">Stack: corosync</div><div class="line">Current DC: node02 (version 1.1.13-a14efad) - partition with quorum</div><div class="line">2 nodes and 1 resource configured</div><div class="line"></div><div class="line">Online: [ node01 node02 ]</div><div class="line"></div><div class="line">Full list of resources:</div><div class="line"></div><div class="line"> stash_vip	(ocf::heartbeat:IPaddr2):	Started node01</div><div class="line"></div><div class="line">PCSD Status:</div><div class="line">  node01: Online</div><div class="line">  node02: Online</div><div class="line"></div><div class="line">Daemon Status:</div><div class="line">  corosync: active/disabled</div><div class="line">  pacemaker: active/disabled</div><div class="line">  pcsd: active/enabled</div></pre></td></tr></table></figure></p>
<p>２ノードともオンラインで、stash_vip は node01に割り当てられています。</p>
<p>ここで node01 の電源をOFFにします</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"># pcs status</div><div class="line">Cluster name: stash</div><div class="line">Last updated: Mon Sep 14 12:18:31 2015		Last change: Mon Sep 14 11:51:35 2015 by root via crm_attribute on node02</div><div class="line">Stack: corosync</div><div class="line">Current DC: node02 (version 1.1.13-a14efad) - partition with quorum</div><div class="line">2 nodes and 1 resource configured</div><div class="line"></div><div class="line">Online: [ node02 ]</div><div class="line">OFFLINE: [ node01 ]</div><div class="line"></div><div class="line">Full list of resources:</div><div class="line"></div><div class="line"> stash_vip	(ocf::heartbeat:IPaddr2):	Started node02</div><div class="line"></div><div class="line">PCSD Status:</div><div class="line">  node01: Offline</div><div class="line">  node02: Online</div><div class="line"></div><div class="line">Daemon Status:</div><div class="line">  corosync: active/enabled</div><div class="line">  pacemaker: active/enabled</div><div class="line">  pcsd: active/enabled</div></pre></td></tr></table></figure>
<p>正常に node02 にIPが切り替わりました。<br>この間pingを192.168.33.101宛に行っていましたが、途切れる事なくノードが切り替わりました。</p>
<h2 id="スタンバイノードの追加">スタンバイノードの追加</h2><p>では、次に稼働中のクラスタに、node01を追加します。</p>
<p>node01を起動し、node01でクラスタを起動します。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pcs cluster start</div></pre></td></tr></table></figure></p>
<p>正常に node01がクラスタに参加しました、ただアクティブノードはnode02のままです。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">pcs status</div><div class="line">Cluster name: stash</div><div class="line">Last updated: Mon Sep 14 12:24:38 2015		Last change: Mon Sep 14 11:51:35 2015 by root via crm_attribute on node02</div><div class="line">Stack: corosync</div><div class="line">Current DC: node02 (version 1.1.13-a14efad) - partition with quorum</div><div class="line">2 nodes and 1 resource configured</div><div class="line"></div><div class="line">Online: [ node01 node02 ]</div><div class="line"></div><div class="line">Full list of resources:</div><div class="line"></div><div class="line"> stash_vip	(ocf::heartbeat:IPaddr2):	Started node02</div><div class="line"></div><div class="line">PCSD Status:</div><div class="line">  node01: Online</div><div class="line">  node02: Online</div><div class="line"></div><div class="line">Daemon Status:</div><div class="line">  corosync: active/disabled</div><div class="line">  pacemaker: active/disabled</div><div class="line">  pcsd: active/enabled</div></pre></td></tr></table></figure>
<h2 id="アクティブノードの手動切替">アクティブノードの手動切替</h2><p>最後に、アクティブノードを切り替えます。<br>片系ずつ切り替えながらメンテナンスする際に威力を発揮しそうです。</p>
<p>アクティブノードをスタンバイ状態にし、強制的にきりかえます。<br>アクティブノード上で下記のコマンドを実行します。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pcs cluster standby</div></pre></td></tr></table></figure></p>
<p>正常にノードが切り替わり、node01がアクティブになりました。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">pcs status</div><div class="line">Cluster name: stash</div><div class="line">Last updated: Mon Sep 14 12:44:33 2015		Last change: Mon Sep 14 12:44:24 2015 by root via crm_attribute on node02</div><div class="line">Stack: corosync</div><div class="line">Current DC: node02 (version 1.1.13-a14efad) - partition with quorum</div><div class="line">2 nodes and 1 resource configured</div><div class="line"></div><div class="line">Node node02: standby</div><div class="line">Online: [ node01 ]</div><div class="line"></div><div class="line">Full list of resources:</div><div class="line"></div><div class="line"> stash_vip	(ocf::heartbeat:IPaddr2):	Started node01</div><div class="line"></div><div class="line">PCSD Status:</div><div class="line">  node01: Online</div><div class="line">  node02: Online</div><div class="line"></div><div class="line">Daemon Status:</div><div class="line">  corosync: active/disabled</div><div class="line">  pacemaker: active/disabled</div><div class="line">  pcsd: active/enabled</div></pre></td></tr></table></figure>
<p>ただ、このままですと node01に障害が発生した場合でもnode02に切り替わらないので、node02のスタンバイ状態を解除します。<br>スタンバイ状態のノードで以下のコマンドを実行します。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pcs cluster unstandby</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">pcs status</div><div class="line">Cluster name: stash</div><div class="line">Last updated: Mon Sep 14 12:46:29 2015		Last change: Mon Sep 14 12:46:27 2015 by root via crm_attribute on node02</div><div class="line">Stack: corosync</div><div class="line">Current DC: node02 (version 1.1.13-a14efad) - partition with quorum</div><div class="line">2 nodes and 1 resource configured</div><div class="line"></div><div class="line">Online: [ node01 node02 ]</div><div class="line"></div><div class="line">Full list of resources:</div><div class="line"></div><div class="line"> stash_vip	(ocf::heartbeat:IPaddr2):	Started node01</div><div class="line"></div><div class="line">PCSD Status:</div><div class="line">  node01: Online</div><div class="line">  node02: Online</div><div class="line"></div><div class="line">Daemon Status:</div><div class="line">  corosync: active/disabled</div><div class="line">  pacemaker: active/disabled</div><div class="line">  pcsd: active/enabled</div></pre></td></tr></table></figure>
<p>node02がアクティブになりました。</p>
<h1 id="今回はここまで">今回はここまで</h1><p>これでひと通りのクラスタ切り替えの動作の確認が出来ました。<br>しかしながら、IPの切り替えだけではStashの冗長化は出来ません。<br>次回は、ストレージの冗長化を設定しStashの冗長化を完成させたいと思います。</p>
<p>参考資料：<br><a href="https://access.redhat.com/documentation/ja-JP/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/" target="_blank" rel="external">RED HAT ENTERPRISE LINUX 7 向け HIGH AVAILABILITY ADD-ON のリファレンスドキュメント</a><br>リファレンスなので、ひと通り情報は乗っているが、ステップバイステップで構築の手順となっていなく、コマンド例ももう一声ほしいところ。<br>総じて、読み解くのに読者の頑張りが必要なドキュメント。。。</p>
<p><a href="http://kan3aa.hatenablog.com/entry/2015/06/05/135150" target="_blank" rel="external">CentOS7.1でPacemaker+corosyncによるクラスタを構成する（Part.1）</a><br>CentOS7 + Pacemaker でのクラスタ構築からVIP設定までが非常に丁寧にステップバイステップで解説されています。<br>最終的には、このエントリもほぼ似たような感じになってしまいました。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yenjoji.github.io/pages/pages/2015/09/15/setup-stash-ha/" data-id="ciwuih0o4004g00vx1y4gk694" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/pages/tags/Atlassian/">Atlassian</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/pages/tags/Pacemaker/">Pacemaker</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/pages/tags/Stash/">Stash</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-stash-ha-101" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/pages/2015/09/08/stash-ha-101/" class="article-date">
  <time datetime="2015-09-08T03:10:00.000Z" itemprop="datePublished">2015-09-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/pages/2015/09/08/stash-ha-101/">Atlassian Stashの耐障害性を高めよう その1 プランニング編</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="はじめに">はじめに</h1><p>私の所属しているプロジェクトではAtlassian Stash （Git）でソースコードを管理しています。<br><br>普段何気なく使用しているGitですが、もはや手放すことが難しい存在です。</p>
<p>そんな中、ふと「もしもStashのデータが消失したら。」と言う事態を想像してみました。<br><br>Gitは分散バージョン管理なので、各々のローカルのGitリポジトリをかき集めれば必要なものは復旧できそうです。</p>
<p>どうやらソースコードの消失などの最悪の事態は発生しないことはわかりましたが、<br><br>Stashを使用していればサーバーの冗長構成は必要ないでしょうか。</p>
<p><a href="https://confluence.atlassian.com/stash/high-availability-for-stash-437915322.html" target="_blank" rel="external">Atlassian</a>のドキュメントによると、Stashに障害が発生した場合、復旧作業をおこなっている間、下記の様な状況になります。</p>
<ul>
<li><p>できること</p>
<ul>
<li>開発者<ul>
<li>コードのコミット</li>
<li>ブランチの作成</li>
<li>ブランチの切り替え</li>
<li>過去のコミットと差分確認</li>
<li>…</li>
<li>Stashを経由せずに他の開発者のリポジトリからフェッチする</li>
</ul>
</li>
</ul>
</li>
<li><p>できないこと</p>
<ul>
<li>開発者<ul>
<li>リポジトリのクローン</li>
<li>セントラルリポジトリ（Stash）からのフェッチ</li>
<li>セントラルリポジトリ（Stash）へのプッシュ</li>
<li>Stash UI へのアクセス （プルリクエストの操作など）</li>
</ul>
</li>
<li>CI/CDサーバー<ul>
<li>リポジトリのクローン</li>
<li>変更点の取得</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>作業は続行不可能では無いですが、チーム開発を進めていく上でかなりの制限となってしまいそうです。</p>
<p>というわけで、転ばぬ先の杖ということでStashの冗長化に挑戦してみたいと思います。</p>
<p>Stash冗長化について調べてみたところ、本家Atlassianに<a href="https://confluence.atlassian.com/stash/high-availability-for-stash-437915322.html" target="_blank" rel="external">冗長化についてのドキュメント</a>が用意されていました。<br></p>
<h1 id="冗長構成のパターン">冗長構成のパターン</h1><p>Atlassianのドキュメントによると、冗長構成には以下の様なパターンがあるようです</p>
<table>
<thead>
<tr>
<th>構成</th>
<th>復旧時間</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>Single node</td>
<td>hours-days</td>
<td>単一ノード</td>
</tr>
<tr>
<td>Cold Standby</td>
<td>2-10 min</td>
<td>サーバーはActive StandByともに起動させておくが、StashはActive側のみ起動しておく構成。Active側が障害となった場合StandBy側のStashを起動させ、切り替える。</td>
</tr>
<tr>
<td>Warm Standby</td>
<td>0-30 Sec</td>
<td>Active Standby 双方にStashを起動させておき、Active側が障害となった場合切り替える</td>
</tr>
<tr>
<td>Active-Active</td>
<td>&lt;5 Sec</td>
<td>マルチマスタ＆負荷分散構成 ただし Stash Data Center が必要</td>
</tr>
</tbody>
</table>
<p>この構成の内、Active-Active構成をするためには Stash Data Centerを使う必要があるらしく、<br>予算的に厳しい様な予感がするので今回は見送ることとします。</p>
<p>また、Warm StandBy 構成 はStashがメモリ上にロック情報などを持っているため、現時点でこの構成は取れないそうです。</p>
<p>そうすると、コストとメリットのバランスを考えた場合Cold Standby構成を取るのが良いようです。<br><br>（Atlassianのドキュメントもこの構成でクラスタを組んでいます。）</p>
<p>図で表すと、下記の様になります。おおむねAtlassianのドキュメント通りですが、データベースのみ、他のAtlassianプロダクトと共有することを考えて、Stashとは別のサーバーとしています。</p>
<p><a data-flickr-embed="true" href="https://www.flickr.com/photos/130999506@N07/21266389192/in/dateposted-public/" title="atlassian_stash_cluster_network_diagram" target="_blank" rel="external"><img src="https://farm1.staticflickr.com/710/21266389192_c7ff5dfa6d.jpg" width="407" height="500" alt="atlassian_stash_cluster_network_diagram"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></p>
<p>細かいソフトウェアのバージョンなどはもう少し調べてみてから決定していきたいと思います。</p>
<p>というわけで、だいたいの構成の目処がついたところで、今回はここまでとしたいと思います。</p>
<p>次回は実際のクラスターの構築を行ってみたいと思います。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yenjoji.github.io/pages/pages/2015/09/08/stash-ha-101/" data-id="ciwuih0o6004j00vxpejhb6pn" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/pages/tags/Atlassian/">Atlassian</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/pages/tags/Pacemaker/">Pacemaker</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/pages/tags/Stash/">Stash</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-about-application-link" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/pages/2015/09/05/about-application-link/" class="article-date">
  <time datetime="2015-09-05T03:00:00.000Z" itemprop="datePublished">2015-09-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/pages/2015/09/05/about-application-link/">Atlassian製品のアドバンテージ「Application Link」</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Application_Linkとは">Application Linkとは</h1><p>アプリケーションリンクとは、Atlassian製品にデフォルトで含まれている、Jira, Confluence, Stash, FishEye, Crucible, Bambooの各製品を相互に連携させるための機能です。<br>アプリケーションリンクを設定すると、リンクさせた製品同士が相互に情報をやりとりしたり、お互いの機能を利用することが出来ます。<br>例えば、JiraとConfluenceをリンクさせた場合、JiraのチケットをConfluenceのマクロを利用してリンクさせたり、<br>Confluenceで任意の文字列を選択した状態で右クリックからJiraのチケットを作成するなど、お互いの利便性を向上させることが出来る機能です。</p>
<p>Atlassian以外の製品でも、CIツールと、リポジトリ管理ツールの連携や、課題管理ツールとCIツールの連携などが用意されている場合もありますが、<br>違うプロダクトを連携させる場合とくらべてAtlassianのアプリケーションリンクはより密接な連携ができるというメリットがあります。<br>また、設定も簡単にできるため、「サクッと連携できると思っていたけのに意外とハマった。」ということが起こらない点もメリットといえると思います。</p>
<h1 id="Bamboo_+_Stash_をリンクすると">Bamboo + Stash をリンクすると</h1><p>では、具体的にはどうなるのでしょうか。<br><a href="https://confluence.atlassian.com/bamboo/integrating-bamboo-with-atlassian-applications-289276942.html" target="_blank" rel="external">Bambooの公式ドキュメント</a> によると、<br>リンクをすることにより以下のことができるようになります。</p>
<ol>
<li>Stashのリポジトリに新しいコードがpushされると自動的にビルドを実行させることが出来ます。（Stash以外のリポジトリの場合はBambooが定期的に更新を確認する必要があります）</li>
<li>Stashの指定したリポジトリに新しいブランチが作成された場合、Bambooが自動的にそれを検知し、ブランチのビルドプランを作成します。<br>また、ブランチが削除された場合はBamboo上のブランチに対するビルドプランを自動的に削除することも可能です。</li>
<li>Bambooのビルド結果から、そのビルドに含まれているコミットの変更差分確認画面へダイレクトにジャンプ出来ます。</li>
<li>Bambooのビルドに含まれているStashのコミットのリストをBambooのビルド結果から確認出来ます。</li>
<li>コミットやプルリクエストに対するビルド結果をStash側で確認することが出来ます。</li>
</ol>
<h2 id="ブランチの自動作成">ブランチの自動作成</h2><p>アプリケーションリンクの機能は業務でも使用していますが、今回はその中でも便利だと感じているブランチの自動作成機能を紹介します。</p>
<ul>
<li>Bambooのビルドプラン設定からブランチの自動作成設定が出来ます、すべてのブランチを作成することもできますし、正規表現にマッチするブランチだけを自動作成することも出来ます。<br>GitFlowで開発している場合に、featureブランチのみ自動作成するという設定も可能です。</li>
</ul>
<p><a data-flickr-embed="true" href="https://www.flickr.com/photos/130999506@N07/21758626085/in/dateposted-public/" title="20150904_0936_myproject_-_myplan__Edit_plan_configuration_-_Atlassian_Bamboo_01" target="_blank" rel="external"><img src="https://farm1.staticflickr.com/649/21758626085_e53647b3c9.jpg" width="500" height="360" alt="20150904_0936_myproject_-_myplan__Edit_plan_configuration_-_Atlassian_Bamboo_01"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></p>
<ul>
<li>Stashで（もしくはGitコマンド経由で）ブランチを作成すると。</li>
</ul>
<p><a data-flickr-embed="true" href="https://www.flickr.com/photos/130999506@N07/21571764779/in/dateposted-public/" title="20150904_0939_ブランチの作成_-_Stash_01" target="_blank" rel="external"><img src="https://farm6.staticflickr.com/5717/21571764779_daed59fe99.jpg" width="500" height="359" alt="20150904_0939_ブランチの作成_-_Stash_01"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></p>
<ul>
<li>Bambooが自動的にブランチをビルドプランに追加してくれます。</li>
</ul>
<p><a data-flickr-embed="true" href="https://www.flickr.com/photos/130999506@N07/21746980562/in/dateposted-public/" title="20150904_0948_myproject_-_myplan__Edit_plan_configuration_-_Atlassian_Bamboo_01" target="_blank" rel="external"><img src="https://farm1.staticflickr.com/648/21746980562_c50df04b23.jpg" width="500" height="360" alt="20150904_0948_myproject_-_myplan__Edit_plan_configuration_-_Atlassian_Bamboo_01"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></p>
<p>ビルド対象のリポジトリが少ないうちは、Bambooの管理画面から手動でブランチを追加する作業も苦になりませんが、<br>リポジトリが増えてくるに連れて徐々に便利さが実感できるようになってきます。</p>
<h1 id="その他の製品のApplication_Linkについて">その他の製品のApplication Linkについて</h1><p>さて、こんなに便利なApplicationLinkですが、今回例に上げたBambooとStashの組み合わせ以外にも様々な組み合わせが存在します。<br>ApplicationLinkを設定することでどんなメリットがあるかは下記リンク先のドキュメントをご参照ください。</p>
<p>Stash<br><a href="https://confluence.atlassian.com/stash/integrating-stash-with-atlassian-applications-414812190.html" target="_blank" rel="external">https://confluence.atlassian.com/stash/integrating-stash-with-atlassian-applications-414812190.html</a></p>
<p>Jira+Confluence<br><a href="https://confluence.atlassian.com/doc/use-jira-and-confluence-together-427623543.html" target="_blank" rel="external">https://confluence.atlassian.com/doc/use-jira-and-confluence-together-427623543.html</a></p>
<p>Bamboo+Confluence<br><a href="https://confluence.atlassian.com/bamboo/integrating-bamboo-with-confluence-289276944.html" target="_blank" rel="external">https://confluence.atlassian.com/bamboo/integrating-bamboo-with-confluence-289276944.html</a></p>
<p>RedmineなどのAtlassian製品以外のツールでも、CIサーバーや、リポジトリ管理ツールなどとの連携は可能ですが、<br>簡単で設定でハマりにくいという点でAtlassian製品ツールが完結させられるというメリットは大きいです。</p>
<p>もし、Atlassian製品をお使いなら、非常に便利ですので、是非アプリケーションリンクを活用してみてください。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yenjoji.github.io/pages/pages/2015/09/05/about-application-link/" data-id="ciwuih0ne003u00vxsh6k5o0p" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/pages/tags/Atlassian/">Atlassian</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/pages/tags/Bamboo/">Bamboo</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/pages/tags/Stash/">Stash</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-integrated-crowd-with-bamboo" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/pages/2015/08/12/integrated-crowd-with-bamboo/" class="article-date">
  <time datetime="2015-08-12T03:00:00.000Z" itemprop="datePublished">2015-08-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/pages/2015/08/12/integrated-crowd-with-bamboo/">Atlassian Bamboo + Crowd 後編：Crowdとの連携</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="BambooとCrowdの連携">BambooとCrowdの連携</h1><p>今回は前回の続きとして、BambooとCrowdを連携させて、<br>ユーザーをCrowdで一元管理できるようにしたいと思います。</p>
<p>前回同様、基本的には<a href="https://confluence.atlassian.com/display/CROWD/Integrating+Crowd+with+Atlassian+Bamboo" target="_blank" rel="external">公式の手順</a> に沿ってすすめていきます。</p>
<p>全体的な流れは</p>
<ol>
<li>Crowdにユーザーとグループ、Bambooとの連携設定を行う</li>
<li>Bamboo側でCrowdへの接続設定を行う</li>
<li>Bambooのユーザー認証をCrowdに切り替える</li>
</ol>
<p>です。</p>
<h1 id="Crowd設定">Crowd設定</h1><p>まずはCrowd側にBamboo用のユーザーの作成と、連携のための設定を行います。</p>
<p>Crowdに以下のユーザーを作成してBambooと連携します。</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Group</th>
<th>Bambooのロール</th>
</tr>
</thead>
<tbody>
<tr>
<td>bamboo</td>
<td>bamboo-admin</td>
<td>管理者</td>
</tr>
<tr>
<td>bamboo-user</td>
<td>bamboo-user</td>
<td>一般ユーザー</td>
</tr>
</tbody>
</table>
<h2 id="ユーザーの追加">ユーザーの追加</h2><p>Bamboo用にユーザーを追加します。</p>
<ul>
<li>Top画面から「Users」タブをクリック</li>
</ul>
<p><a data-flickr-embed="true" href="https://www.flickr.com/photos/130999506@N07/19857718703/in/dateposted-public/" title="0810_1111_Atlassian_Crowd_-_Administration_console" target="_blank" rel="external"><img src="https://farm1.staticflickr.com/348/19857718703_95f9644a40.jpg" width="500" height="344" alt="0810_1111_Atlassian_Crowd_-_Administration_console"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></p>
<ul>
<li>「Add User」リンクをクリックし、ユーザー登録画面にて必要な情報を入力し「Create」ボタンをクリック</li>
</ul>
<p><a data-flickr-embed="true" href="https://www.flickr.com/photos/130999506@N07/20484923911/in/dateposted-public/" title="0810_1118_Atlassian_Crowd_-_Users" target="_blank" rel="external"><img src="https://farm1.staticflickr.com/398/20484923911_e250a52b18.jpg" width="500" height="344" alt="0810_1118_Atlassian_Crowd_-_Users"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></p>
<ul>
<li>同様に一般ユーザーも追加します</li>
</ul>
<p><a data-flickr-embed="true" href="https://www.flickr.com/photos/130999506@N07/20290542940/in/dateposted-public/" title="0810_1511_Atlassian_Crowd_-_Add_user" target="_blank" rel="external"><img src="https://farm1.staticflickr.com/403/20290542940_11d5c7b99d.jpg" width="500" height="344" alt="0810_1511_Atlassian_Crowd_-_Add_user"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></p>
<h2 id="グループの作成">グループの作成</h2><p>Bambooでユーザーのロール制御を行うため、ロールに対応したグループを作成します。</p>
<ul>
<li>「Groups」をクリック</li>
</ul>
<p><a data-flickr-embed="true" href="https://www.flickr.com/photos/130999506@N07/20469901562/in/dateposted-public/" title="0810_1512_Atlassian_Crowd_-_Groups" target="_blank" rel="external"><img src="https://farm1.staticflickr.com/304/20469901562_baf6196f36.jpg" width="500" height="344" alt="0810_1512_Atlassian_Crowd_-_Groups"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></p>
<ul>
<li>「Add Group」リンクをクリックし、グループ登録画面にて必要な情報を入力し「Create」ボタンをクリック</li>
</ul>
<p><a data-flickr-embed="true" href="https://www.flickr.com/photos/130999506@N07/20478653185/in/dateposted-public/" title="0810_1513_Atlassian_Crowd_-_Add_group" target="_blank" rel="external"><img src="https://farm1.staticflickr.com/561/20478653185_ded6662813.jpg" width="500" height="344" alt="0810_1513_Atlassian_Crowd_-_Add_group"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></p>
<ul>
<li>同様に一般ユーザー用グループも作成します</li>
</ul>
<p><a data-flickr-embed="true" href="https://www.flickr.com/photos/130999506@N07/20291988679/in/dateposted-public/" title="0810_1514_Atlassian_Crowd_-_Add_group" target="_blank" rel="external"><img src="https://farm4.staticflickr.com/3731/20291988679_7901418bdd.jpg" width="500" height="344" alt="0810_1514_Atlassian_Crowd_-_Add_group"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></p>
<h2 id="グループへユーザーを登録">グループへユーザーを登録</h2><p>作成したグループへユーザーを登録します。<br>管理者にしたいユーザーは bamboo-admin グループへ。<br>一般ユーザーにしたいユーザーは bamboo-user グループへ登録します。</p>
<ul>
<li>「Groups」をクリック、「bamboo-admin」リンクをクリック</li>
</ul>
<p><a data-flickr-embed="true" href="https://www.flickr.com/photos/130999506@N07/19855985444/in/dateposted-public/" title="0810_1943_Atlassian_Crowd_-_Groups" target="_blank" rel="external"><img src="https://farm1.staticflickr.com/481/19855985444_abe141bf77.jpg" width="500" height="344" alt="0810_1943_Atlassian_Crowd_-_Groups"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></p>
<ul>
<li>「Direct members」タブをクリックし「Add Users」ボタンをクリック</li>
</ul>
<p><a data-flickr-embed="true" href="https://www.flickr.com/photos/130999506@N07/19857716853/in/dateposted-public/" title="0810_1944_Atlassian_Crowd_-_View_group" target="_blank" rel="external"><img src="https://farm1.staticflickr.com/284/19857716853_931929b751.jpg" width="500" height="344" alt="0810_1944_Atlassian_Crowd_-_View_group"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></p>
<ul>
<li>「Search」ボタンをクリックすると、ユーザーが表示されるので、管理者にしたいユーザーにチェックをし、「Add Selected Users」ボタンをクリック</li>
</ul>
<p><a data-flickr-embed="true" href="https://www.flickr.com/photos/130999506@N07/20290607838/in/dateposted-public/" title="0810_1945_Atlassian_Crowd_-_View_group" target="_blank" rel="external"><img src="https://farm1.staticflickr.com/340/20290607838_576329772c.jpg" width="500" height="344" alt="0810_1945_Atlassian_Crowd_-_View_group"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></p>
<ul>
<li>同様に一般ユーザーも一般ユーザー用のグループへ登録します</li>
</ul>
<p><a data-flickr-embed="true" href="https://www.flickr.com/photos/130999506@N07/19857716413/in/dateposted-public/" title="0810_1949_Atlassian_Crowd_-_View_group" target="_blank" rel="external"><img src="https://farm1.staticflickr.com/325/19857716413_3b98a7619f.jpg" width="500" height="344" alt="0810_1949_Atlassian_Crowd_-_View_group"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></p>
<h2 id="アプリケーションの作成">アプリケーションの作成</h2><p>Crowdで作成したユーザーとBambooを関連付けるため、アプリケーションを登録します。</p>
<ul>
<li>「Application」-&gt; Add application」をクリック</li>
</ul>
<p><a data-flickr-embed="true" href="https://www.flickr.com/photos/130999506@N07/20290542470/in/dateposted-public/" title="0810_1659_Atlassian_Crowd_-_Applications" target="_blank" rel="external"><img src="https://farm1.staticflickr.com/442/20290542470_d6fabcea94.jpg" width="500" height="344" alt="0810_1659_Atlassian_Crowd_-_Applications"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></p>
<ul>
<li>必要な情報を入力し「Next」をクリック</li>
</ul>
<table>
<thead>
<tr>
<th>項目</th>
<th>設定値</th>
</tr>
</thead>
<tbody>
<tr>
<td>Apprication type</td>
<td>Bamboo</td>
</tr>
<tr>
<td>Name</td>
<td>Bamboo</td>
</tr>
<tr>
<td>Password</td>
<td>任意のパスワード</td>
</tr>
</tbody>
</table>
<p>ここで設定するパスワードはBambooとCrowdが連携する際の認証に使用します</p>
<ul>
<li>BambooとCrowdの通信設定を入力し「Next」をクリック<br>URLにユーザーがアクセスするURLを、Remote IP AddressにBambooサーバーとCrowdサーバーが通信する際のBambooサーバーのIPアドレスを設定します。</li>
</ul>
<p><a data-flickr-embed="true" href="https://www.flickr.com/photos/130999506@N07/20484923151/in/dateposted-public/" title="0810_1702_Atlassian_Crowd_-_Add_application" target="_blank" rel="external"><img src="https://farm1.staticflickr.com/262/20484923151_130eb04853.jpg" width="500" height="344" alt="0810_1702_Atlassian_Crowd_-_Add_application"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></p>
<ul>
<li>ユーザーディレクトリの選択<br>Bambooの認証で使用するユーザーが存在する、ユーザーディレクトリを選択します。<br>今回では、先ほどの手順でユーザーを作成した際に指定したディレクトリを選択します。</li>
</ul>
<p><a data-flickr-embed="true" href="https://www.flickr.com/photos/130999506@N07/19857717813/in/dateposted-public/" title="0810_1703_Atlassian_Crowd_-_Add_application" target="_blank" rel="external"><img src="https://farm4.staticflickr.com/3744/19857717813_8e426830fd.jpg" width="500" height="344" alt="0810_1703_Atlassian_Crowd_-_Add_application"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></p>
<ul>
<li>グループの選択<br>Bambooで認証に使用するグループを追加します。</li>
</ul>
<p><a data-flickr-embed="true" href="https://www.flickr.com/photos/130999506@N07/20452412876/in/dateposted-public/" title="0810_1708_Atlassian_Crowd_-_Add_application" target="_blank" rel="external"><img src="https://farm1.staticflickr.com/309/20452412876_487acf451f.jpg" width="500" height="344" alt="0810_1708_Atlassian_Crowd_-_Add_application"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></p>
<ul>
<li>登録内容の確認<br>登録内容を確認し登録します。</li>
</ul>
<p><a data-flickr-embed="true" href="https://www.flickr.com/photos/130999506@N07/20290608388/in/dateposted-public/" title="0810_1709_Atlassian_Crowd_-_Add_application" target="_blank" rel="external"><img src="https://farm1.staticflickr.com/339/20290608388_26006ce9f9.jpg" width="500" height="344" alt="0810_1709_Atlassian_Crowd_-_Add_application"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></p>
<h1 id="Bamboo_の設定">Bamboo の設定</h1><h2 id="Crowdとの通信設定">Crowdとの通信設定</h2><ul>
<li>crowd.properties の編集<br>{BAMBOO_ROOT:/opt/atlassian/bamboo}/atlassian-bamboo/WEB-INF/classes/crowd.properties を編集します。</li>
</ul>
<p>マニュアルには以下の４点を変更せよと書いてありますが、session.validationintervalはデフォルトの２分で問題ないためそのままにします。</p>
<table>
<thead>
<tr>
<th>項目</th>
<th>内容</th>
</tr>
</thead>
<tbody>
<tr>
<td>application.name</td>
<td>bamboo</td>
</tr>
<tr>
<td>application.password</td>
<td>{CrowdのApplication設定で設定したパスワード}</td>
</tr>
<tr>
<td>crowd.server.url</td>
<td><a href="http://127.0.0.1:8095/crowd/services/" target="_blank" rel="external">http://127.0.0.1:8095/crowd/services/</a></td>
</tr>
<tr>
<td>session.validationinterval</td>
<td>2</td>
</tr>
</tbody>
</table>
<ul>
<li>Bambooの認証システムのCrowdへの切り替え<ul>
<li>atlassian-user.xml の編集<br>{BAMBOO_ROOT:/opt/atlassian/bamboo}/atlassian-bamboo/WEB-INF/classes/atlassian-user.xml を編集します。</li>
</ul>
</li>
</ul>
<p>Crowd用の設定がコメントアウトされているので、コメントを外します。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;!--&lt;crowd key=&quot;crowd&quot; name=&quot;Crowd Repository&quot;/&gt;--&gt;</div><div class="line">↓</div><div class="line">&lt;crowd key=&quot;crowd&quot; name=&quot;Crowd Repository&quot;/&gt;</div></pre></td></tr></table></figure>
<h2 id="ユーザーディレクトリの設定">ユーザーディレクトリの設定</h2><ul>
<li>Bambooに管理者でログインし 「右上の歯車マーク &gt; Overview」をクリック</li>
<li><p>「Bamboo administration」画面が表示されるので 「Security」グループの「User repositories」をクリック</p>
</li>
<li><p>Server URL, Application Nameを確認、 Application PasswordにCrowdに設定したパスワードを入力します。</p>
</li>
</ul>
<p><a data-flickr-embed="true" href="https://www.flickr.com/photos/130999506@N07/20290541630/in/dateposted-public/" title="0810_1934_User_repositories_-_Atlassian_Bamboo" target="_blank" rel="external"><img src="https://farm1.staticflickr.com/480/20290541630_fdb19ac328.jpg" width="500" height="344" alt="0810_1934_User_repositories_-_Atlassian_Bamboo"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></p>
<p>これでめでたくBambooの認証をCrowdに統合することが出来ました。</p>
<p>連携しているサービスがBambooだけですとそれほどメリットが感じられないかも知れませんが、 ここで上げたBamboo以外、Jira、Confluence、StashなどのAtlassianの製品を導入していくにつれてユーザー管理コストの軽減効果が実感できるものと考えております。</p>
<p>また、ユーザーの追加・削除漏れなどのセキュリティリスクの軽減にもつながりますので、Atlassian製品導入の際には合わせてCrowdの導入もご検討ください。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yenjoji.github.io/pages/pages/2015/08/12/integrated-crowd-with-bamboo/" data-id="ciwuih0no004500vxia29iplt" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/pages/tags/Atlassian/">Atlassian</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/pages/tags/Bamboo/">Bamboo</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/pages/tags/CI/">CI</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/pages/tags/Crowd/">Crowd</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-installing-atlassian-bamboo" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/pages/2015/08/04/installing-atlassian-bamboo/" class="article-date">
  <time datetime="2015-08-04T03:00:00.000Z" itemprop="datePublished">2015-08-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/pages/2015/08/04/installing-atlassian-bamboo/">Atlassian Bamboo + Crowd 前編：Bambooの導入</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Bambooとは">Bambooとは</h1><p>Atlassian社製のCI（継続的インテグレーション）/CD（継続的デリバリー）を実現するソフトウェアであり、同様のソフトウェアにはJenkinsやCircleCI、TravisCIなどが存在します。</p>
<p>今回は、そんなBambooをセットアップし、ユーザー管理を以前紹介したCrowdに統合する方法をご紹介したいと思います。</p>
<p>これにより、システム管理者、運用者の負荷を軽減してくれるBamboo。それ自体の管理負荷を下げて、より生産的で楽しいことに注力できるようにしたいと思います。</p>
<p>今回は、前編として、Bambooのインストール方法をご紹介させて頂きます。</p>
<h1 id="Bamboo_の_インストール">Bamboo の インストール</h1><p>基本的には公式手順にのとって進めていきます。</p>
<h2 id="前提条件">前提条件</h2><h3 id="システム環境">システム環境</h3><ul>
<li>OS   : CentOS 7.0</li>
<li>Java : Oracle JDK 8u51</li>
<li>DB   : 5.5.40-MariaDB</li>
</ul>
<h3 id="Bamboo配置先">Bamboo配置先</h3><ul>
<li>インストール先 : /opt/atlassian/bamboo</li>
<li>データディレクトリ : /var/atlassian/application-data/bamboo</li>
</ul>
<h2 id="インストール">インストール</h2><h3 id="最新版のダウンロード">最新版のダウンロード</h3><ul>
<li>公式サイトより最新版をダウンロードします。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">wget https://www.atlassian.com/software/bamboo/downloads/binary/atlassian-bamboo-5.9.3.tar.gz</div></pre></td></tr></table></figure>
<h3 id="展開と配置">展開と配置</h3><p>ダウンロードしたBambooのアーカイブを展開し、配置します。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">tar xf atlassian-bamboo-5.9.3.tar.gz</div><div class="line">mv atlassian-bamboo-5.9.3 /opt/atlassian/</div><div class="line">ln -s /opt/atlassian/atlassian-bamboo-5.9.3 /opt/atlassian/bamboo</div></pre></td></tr></table></figure>
<h3 id="bambooの初期設定">bambooの初期設定</h3><ul>
<li>Bambooデータパスの設定</li>
</ul>
<p>マニュアルに記載のある通り<br>/opt/atlassian/bamboo/atlassian-bamboo/WEB-INF/classes/bamboo-init.properties<br>を以下の様に修正します。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">bamboo.home=/var/atlassian/application-data/bamboo</div></pre></td></tr></table></figure>
<ul>
<li>Bambooメモリ設定の変更<br>/opt/atlassian/bamboo/bin/setenv.sh のメモリ設定を任意の値に変更します。<br>最大1GB程度にしておけばひとまず問題ないと思われます。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">JVM_MINIMUM_MEMORY=&quot;512m&quot;</div><div class="line">JVM_MAXIMUM_MEMORY=&quot;1024m&quot;</div></pre></td></tr></table></figure>
<h3 id="データベースの準備">データベースの準備</h3><p>次にデータ保存先であるデータベースを準備します。<br>今回はBambooのデータ保存先としてcrowdインストール編で用意したMySQL(MariaDB)を使用します。</p>
<ul>
<li>データベースの作成</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">create</span> <span class="keyword">database</span> bamboo <span class="built_in">character</span> <span class="keyword">set</span> utf8 <span class="keyword">collate</span> utf8_bin;</div></pre></td></tr></table></figure>
<ul>
<li>ユーザーを作成し権限を付与</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">GRANT</span> ALL <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> bamboo.* <span class="keyword">TO</span> <span class="string">'bamboouser'</span>@<span class="string">'localhost'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'bamboopass'</span>;</div></pre></td></tr></table></figure>
<ul>
<li>DBドライバの配置</li>
</ul>
<p>Mysqlのドライバを予めBamboo配下に配置しておきます。</p>
<p>/opt/atlassian/bamboo/lib</p>
<p>以下に ドライバのjarファイルを配置しておきます。</p>
<h3 id="起動">起動</h3><p>ひとまず起動します</p>
<h2 id="初期設定">初期設定</h2><p><a href="http://{bambooインストールIP}:8085/" target="_blank" rel="external">http://{bambooインストールIP}:8085/</a> にアクセスすると、<br>初期設定画面が表示されるので、画面に従って初期設定を行います。</p>
<ul>
<li>ライセンスキーの入力<br>事前に用意してあればそのライセンスキーを入力します。<br>評価用であればAtlassian公式サイトよりトライアルキーが取得出来ますので、それを入力します。</li>
</ul>
<p><a data-flickr-embed="true" href="https://www.flickr.com/photos/130999506@N07/21520972128/in/dateposted-public/" title="Bamboo_setup_wizard_-_Atlassian_Bamboo_1006" target="_blank" rel="external"><img src="https://farm1.staticflickr.com/675/21520972128_3400b65db1.jpg" width="500" height="335" alt="Bamboo_setup_wizard_-_Atlassian_Bamboo_1006"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></p>
<ul>
<li>Bambooディレクトリ設定<br>通常であれば変更の必要がないため、そのままContinueします。</li>
</ul>
<p><a data-flickr-embed="true" href="https://www.flickr.com/photos/130999506@N07/21708803895/in/dateposted-public/" title="General_configuration_-_Atlassian_Bamboo_1008" target="_blank" rel="external"><img src="https://farm1.staticflickr.com/632/21708803895_6e621099ac.jpg" width="500" height="335" alt="General_configuration_-_Atlassian_Bamboo_1008"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></p>
<ul>
<li>データベースの選択<br>Bambooのデータを保存するデータベースを選択します。<br>今回はMySQLに保存するため、MySQLを選択しContinueします。</li>
</ul>
<p><a data-flickr-embed="true" href="https://www.flickr.com/photos/130999506@N07/21086099034/in/dateposted-public/" title="Choose_a_database_configuration_-_Atlassian_Bamboo_1443" target="_blank" rel="external"><img src="https://farm1.staticflickr.com/670/21086099034_5a003519a7.jpg" width="500" height="328" alt="Choose_a_database_configuration_-_Atlassian_Bamboo_1443"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></p>
<ul>
<li>データベース接続パラメータの設定<br>データベースの準備で作成したデータベースへの接続パラメータを入力しContinueします。<br>Continueを押すと、データベースの初期設定が始まります。<br>しばらく時間がかかるので、根気よく待ちましょう。</li>
</ul>
<p><a data-flickr-embed="true" href="https://www.flickr.com/photos/130999506@N07/21521013788/in/dateposted-public/" title="Choose_how_you_wish_Bamboo_to_connect_to_your_database_-_Atlassian_Bamboo_1449" target="_blank" rel="external"><img src="https://farm1.staticflickr.com/579/21521013788_2813a91496.jpg" width="500" height="335" alt="Choose_how_you_wish_Bamboo_to_connect_to_your_database_-_Atlassian_Bamboo_1449"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></p>
<ul>
<li>データ移行<br>今回は新規インストールですので、「Createa new Bamboo home」を選択しContinueします。</li>
</ul>
<p><a data-flickr-embed="true" href="https://www.flickr.com/photos/130999506@N07/21520969818/in/dateposted-public/" title="Select_starting_data_for_Bamboo_-_Atlassian_Bamboo_1537" target="_blank" rel="external"><img src="https://farm1.staticflickr.com/658/21520969818_909f6fe436.jpg" width="500" height="334" alt="Select_starting_data_for_Bamboo_-_Atlassian_Bamboo_1537"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></p>
<ul>
<li>管理ユーザーの作成<br>任意のIDとパスワードで管理ユーザーを作成します。</li>
</ul>
<p><a data-flickr-embed="true" href="https://www.flickr.com/photos/130999506@N07/21520969468/in/dateposted-public/" title="Set_up_administrator_user_-_Atlassian_Bamboo_1538" target="_blank" rel="external"><img src="https://farm1.staticflickr.com/779/21520969468_47458f8415.jpg" width="500" height="327" alt="Set_up_administrator_user_-_Atlassian_Bamboo_1538"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></p>
<p>以上で、Bambooのインストールは完了です。<br>次回は、以前インストールしたCrowdとBambooを連携させて、ユーザー管理をCrowdに統合したいと思います。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yenjoji.github.io/pages/pages/2015/08/04/installing-atlassian-bamboo/" data-id="ciwuih0ni003y00vxgv5tymke" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/pages/tags/Atlassian/">Atlassian</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/pages/tags/Bamboo/">Bamboo</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/pages/tags/CI/">CI</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/pages/tags/Crowd/">Crowd</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-getting-start-play-with-idea" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/pages/2015/07/23/getting-start-play-with-idea/" class="article-date">
  <time datetime="2015-07-23T12:23:11.000Z" itemprop="datePublished">2015-07-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/pages/2015/07/23/getting-start-play-with-idea/">Play! Scalaを Macで始める</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Play!_Scalaを_Macで始める">Play! Scalaを Macで始める</h1><p>久しぶりにPlay!に触ったら昔とだいぶ違ったのでメモ。</p>
<h1 id="今回の目標">今回の目標</h1><ol>
<li>Play!をインストール</li>
<li>プロジェクトのスケルトンを作成</li>
<li>IntellijIDEAで開発スタートする準備をする<br>ところまでが目標。</li>
</ol>
<h1 id="Play!のインストール">Play!のインストール</h1><p>しばらくぶりにPlay!にさわろうと思ったら、playコマンドがなくなっていて、今はtypesafe-activatorにその役目を譲っているらしいので、typesafe-activatorをインストールします。<br>typesafe-activatorとその開発元のTypesafe社は <a href="http://osdn.jp/magazine/13/08/15/150000" target="_blank" rel="external">http://osdn.jp/magazine/13/08/15/150000</a> <a href="http://osdn.jp/magazine/11/05/13/0340257" target="_blank" rel="external">http://osdn.jp/magazine/11/05/13/0340257</a> この辺りをご参照ください。<br>(私の所属している会社も最近パートナーの末席に仲間入りしました。 <a href="https://www.typesafe.com/partners/systemintegrator-partners#community" target="_blank" rel="external">https://www.typesafe.com/partners/systemintegrator-partners#community</a> )</p>
<p>typesafe-activatorはhomebrewでインストールできるので、おもむろにbrewコマンドでインストールします。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ brew install typesafe-activator                                                                                                                          *[feature/merge]</div><div class="line">==&gt; Downloading https://homebrew.bintray.com/bottles/typesafe-activator-1.3.3.mavericks.bottle.tar.gz</div><div class="line">######################################################################## 100.0%</div><div class="line">==&gt; Pouring typesafe-activator-1.3.3.mavericks.bottle.tar.gz</div><div class="line">🍺  /usr/local/Cellar/typesafe-activator/1.3.3: 4 files, 1.2M</div></pre></td></tr></table></figure>
<h1 id="プロジェクトのスケルトンを作成">プロジェクトのスケルトンを作成</h1><h2 id="プロジェクトの作成">プロジェクトの作成</h2><p>playコマンドの代わりにactivatorコマンドを使用してスケルトンを作成します。<br>いくつか質問されるので順次答えます。</p>
<ol>
<li>テンプレートは 6 の play-scala</li>
<li>アプリケーション名は任意のものを指定</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">$ activator new</div><div class="line"></div><div class="line">Fetching the latest list of templates...</div><div class="line"></div><div class="line">Browse the list of templates: http://typesafe.com/activator/templates</div><div class="line">Choose from these featured templates or enter a template name:</div><div class="line">  1) minimal-akka-java-seed</div><div class="line">  2) minimal-akka-scala-seed</div><div class="line">  3) minimal-java</div><div class="line">  4) minimal-scala</div><div class="line">  5) play-java</div><div class="line">  6) play-scala</div><div class="line">(hit tab to see a list of all templates)</div><div class="line">&gt; 6</div><div class="line">Enter a name for your application (just press enter for &apos;play-scala&apos;)</div><div class="line">&gt; your-project-name</div><div class="line">OK, application &quot;your-project-name&quot; is being created using the &quot;play-scala&quot; template.</div><div class="line"></div><div class="line">To run &quot;your-project-name&quot; from the command line, &quot;cd your-project-name&quot; then:</div><div class="line">/Users/enjoji/projects/your-project-name/activator run</div><div class="line"></div><div class="line">To run the test for &quot;your-project-name&quot; from the command line, &quot;cd your-project-name&quot; then:</div><div class="line">/Users/enjoji/projects/your-project-name/activator test</div><div class="line"></div><div class="line">To run the Activator UI for &quot;your-project-name&quot; from the command line, &quot;cd your-project-name&quot; then:</div><div class="line">/Users/enjoji/projects/your-project-name/activator ui</div></pre></td></tr></table></figure>
<h2 id="動作確認">動作確認</h2><p>プロジェクトが出来たので試しに起動してみます。<br>プロジェクトのディレクトリに移動し、 activator run を実行しエラーなく起動すればOKです。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ activator run</div><div class="line">Getting org.scala-sbt sbt 0.13.8 ...</div><div class="line">downloading https://repo1.maven.org/maven2/org/scala-lang/scala-compiler/2.10.4/scala-compiler-2.10.4.jar</div></pre></td></tr></table></figure>
<p>どうやらJava8じゃないと起動しない模様</p>
<h2 id="IntelliJで使う">IntelliJで使う</h2><h3 id="Intellij_Install">Intellij Install</h3><ul>
<li><p>まずは IntalliJ IDEA をインストールします。</p>
</li>
<li><p>次に必要なプラグインをインストールします</p>
<ul>
<li>Plugin<ul>
<li>SBT</li>
<li>Scala<br>プラグインをインストール</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="ソースのインポート">ソースのインポート</h3><p>ソースコードをIDEAプロジェクトとしてインポートします。</p>
<ol>
<li>メニューを File&gt;New&gt;Project from Existing Source とたどります。</li>
<li>ソースルートを選択</li>
<li>Import project from external model</li>
<li>SBTを選択</li>
<li>Project SDK に Java8 を選択し Finish</li>
</ol>
<p>以上で、Play＋ScalaのスケルトンプロジェクトができてIDEAでの開発準備が整いました。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yenjoji.github.io/pages/pages/2015/07/23/getting-start-play-with-idea/" data-id="ciwuih0ng003w00vx4ohbkd2n" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/pages/tags/IntellijIDEA/">IntellijIDEA</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/pages/tags/Play/">Play</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/pages/tags/Scala/">Scala</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-mackerel-raspi-temp" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/pages/2015/07/14/mackerel-raspi-temp/" class="article-date">
  <time datetime="2015-07-14T12:49:44.000Z" itemprop="datePublished">2015-07-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/pages/2015/07/14/mackerel-raspi-temp/">Mackerel + Raspberry Pi で 職場環境をモニタリング</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Mackerel + Raspberry Pi で 職場環境をモニタリング</p>
<p>皆さんMackerelをご存知ですか？</p>
<p><a href="https://mackerel.io" target="_blank" rel="external">Mackerel</a> とは はてな社が提供しているサーバー監視のサービスで、<br>サーバーにエージェントと言われるモジュールを設置するだけで、サーバーの状況がブラウザからグラフィカルに確認できるサービスです。</p>
<p>また、監視ルールを設定しておくことにより、サーバーが特定の状態（CPU使用率90%以上など）になった場合アラートを通知したり<br>無料プランでも一部制限はありますが、サーバー5台まで監視可能など、お手軽、便利、太っ腹なサービスです。</p>
<p>今回は、そんな本来はサーバー監視のサービスであるMackerelを本来の用途以外に使ってみようと思います。</p>
<h1 id="突然ですが、夏ですね">突然ですが、夏ですね</h1><p>だんだん気候も夏めいて来た今日このごろ、やはり気になるのはオフィスの環境。<br>健康を害するような環境で仕事をしないためにも、暑さで仕事の効率が落ちないためにも職場環境には気を使いたいところです。</p>
<p>というわけで、今回は職場（でなくてもいいですが）の温度と湿度を計測したいと思います。</p>
<h1 id="温度・湿度を測定する">温度・湿度を測定する</h1><p>では、実際に監視システムを構築していきたいと思います。</p>
<h2 id="今回使うもの">今回使うもの</h2><ul>
<li>Raspberry pi 2 Type B</li>
<li>温湿度センサー<ul>
<li>今回はAM2320 <a href="http://akizukidenshi.com/catalog/g/gM-08663/" target="_blank" rel="external">http://akizukidenshi.com/catalog/g/gM-08663/</a> を使用しました。</li>
</ul>
</li>
<li>Raspberry pi と 温度センサー接続用のブレッドボードやジャンパ線<ul>
<li>温度センサーとRaspberry Pi をつなぐための線を必要な分用意します。</li>
</ul>
</li>
<li>以前に使用したズゴック（オプション）</li>
</ul>
<h2 id="ハードウェアの準備">ハードウェアの準備</h2><h3 id="Raspberry_Pi_と_AM2320_を接続する">Raspberry Pi と AM2320 を接続する</h3><p>この実体配線図のようにAM2320をRaspberry Pi と接続します。<br>AM2320は型番のシルク印刷を表に見た場合、<br>左から</p>
<ul>
<li>VDD &lt;-&gt; Pin #2 5V</li>
<li>SDA &lt;-&gt; Pin #3 SDA</li>
<li>GND &lt;-&gt; Pin #20 等 GND</li>
<li>SCL &lt;-&gt; Pin #5 SCL<br>と接続します。</li>
</ul>
<p><a href="https://www.flickr.com/photos/130999506@N07/17211140511" title="raspi_am2320 by Yasuto Enjoji, on Flickr" target="_blank" rel="external"><img src="https://farm8.staticflickr.com/7695/17211140511_d168850efd_z.jpg" width="640" height="479" alt="raspi_am2320"></a></p>
<h2 id="ソフトウエアの準備">ソフトウエアの準備</h2><h3 id="Raspberry_Pi_で_I2C_を使えるようにする">Raspberry Pi で I2C を使えるようにする</h3><p>今回使用する AM2320 という温湿度計モジュールは I2C インターフェース経由でデータを取得します。<br>RaspberryPIは初期状態ではI2Cが有効になっていないため、<br>こちらのページ <a href="https://blog.ymyzk.com/2015/02/enable-raspberry-pi-i2c/" target="_blank" rel="external">https://blog.ymyzk.com/2015/02/enable-raspberry-pi-i2c/</a> を参考にし、I2Cを有効にします。</p>
<h3 id="AM2320からデータを取得するプログラムを用意する">AM2320からデータを取得するプログラムを用意する</h3><p>こちらのコード <a href="https://github.com/takagi/am2321" target="_blank" rel="external">https://github.com/takagi/am2321</a> をベースにし、出力をMackerelに対応させたコードがこちらです。</p>
<div class=""><br>  <script src="https://gist.github.com/yenjoji/40d135519a0741d3718b.js"></script><br></div>

<p>これをRaspberryPI上でコンパイルし、パスの通った場所に配置します。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">curl -LO https://gist.githubusercontent.com/yenjoji/40d135519a0741d3718b/raw/5c7835651a539f16f3446108e15aa482f6c2111f/am2321.c</div><div class="line"></div><div class="line">gcc -lm -o am2321 am2321.c</div><div class="line"></div><div class="line">chmod a+x am2321</div><div class="line">mv am2321 /usr/local/bin</div></pre></td></tr></table></figure>
<h1 id="Mackerelとの連携">Mackerelとの連携</h1><h2 id="Mackerelに登録してオーガニゼーションを作成する">Mackerelに登録してオーガニゼーションを作成する</h2><p><a href="http://help-ja.mackerel.io/entry/getting-started" target="_blank" rel="external">http://help-ja.mackerel.io/entry/getting-started</a><br>の手順にそって、オーガニゼーションを作成します。</p>
<h2 id="maeckrel-agent_をインストールする">maeckrel-agent をインストールする</h2><p>パッケージをダウンロードし、インストールします。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">curl -LO http://file.mackerel.io/agent/deb/mackerel-agent_latest.all.deb</div><div class="line">sudo dpkg -i mackerel-agent_latest.all.deb</div></pre></td></tr></table></figure>
<h2 id="ARM_版バイナリに実行ファイルを置き換える">ARM 版バイナリに実行ファイルを置き換える</h2><p>通常ならば、パッケージをインストールすれば完了ですが、<br>RasperryPiはもともとMackerelが想定しているCPUとアーキテクチャが違うためかそのままではうまく起動しません。<br>そのため、RaspberryPiのCPUにあったアーキテクチャのMackerelの実行ファイルで上書きします。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">curl -LO https://github.com/mackerelio/mackerel-agent/releases/download/v0.17.1/mackerel-agent_linux_arm.tar.gz</div><div class="line">tar xf mackerel-agent_linux_arm.tar.gz</div><div class="line"></div><div class="line">sudo mv /usr/local/bin/mackerel-agent /usr/local/bin/mackerel-agent.org</div><div class="line">sudo mv mackerel-agent_linux_arm/mackerel-agent /usr/local/bin/mackerel-agent</div></pre></td></tr></table></figure>
<h2 id="maeckrel-agentの設定">maeckrel-agentの設定</h2><p>インストールが完了したので、設定をしていきます。</p>
<p>設定ファイルに apiKeyとカスタムメトリクスの設定を追加します。<br>/etc/mackerel-agent/mackerel-agent.conf に オーガニゼーションの画面に表示されているAPIKEYと<br>以下のカスタムメトリクスの設定を追加してください。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># Get room status</div><div class="line">[plugin.metrics.temperature]</div><div class="line">command = &quot;/usr/local/bin/am2321 -m&quot;</div></pre></td></tr></table></figure>
<h2 id="mackerel-agent_起動">mackerel-agent 起動</h2><p>以上で設定がひと通り完了しましたので、エージェントを起動します。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo /etc/init.d/mackerel-agent start</div></pre></td></tr></table></figure>
<p>これで、先ほど作成したオーガニゼーションに自動的にホストが追加され、<br>mackerelのデフォルトの監視項目と、温湿度計のデータが記録されていくようになります。</p>
<p><a data-flickr-embed="true" href="https://www.flickr.com/photos/130999506@N07/19282373940/in/dateposted-public/" title="mackerel-room" target="_blank" rel="external"><img src="https://c1.staticflickr.com/1/281/19282373940_5b6feac8f1.jpg" width="500" height="333" alt="mackerel-room"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></p>
<h1 id="アラートの設定">アラートの設定</h1><p>無事に温度と湿度の記録が始まりました。<br>しかしながらこれだけでは、職場が危機な状況になっても気づくことが出来ません。</p>
<p>ということで、職場の労働環境を監視する尺度として、不快指数を使って職場環境をモニタリングしたいと思います。</p>
<p>実は先程のMackerelカスタムメトリクス取得プログラムには、温度、湿度以外に不快指数も取得できるようにしてあります。<br>なので、手順通りに設定した場合は、すでにカスタムメトリクス上に不快指数が記録されていると思います。</p>
<p>wikipediaによると、日本人は不快指数が77を超えた辺りから一部の方々が不快を覚え始め、80を超えるとみんなが不快感を感じるそうなので、<br>この値を超えた場合に通知が来るように設定したいと思います。</p>
<ol>
<li>Macerel管理画面から Monitor メニューをクリックし、監視ルールを追加ボタンをクリックします。<br><a data-flickr-embed="true" href="https://www.flickr.com/photos/130999506@N07/19282339528/in/dateposted-public/" title="mackerel-monitor_001" target="_blank" rel="external"><img src="https://c1.staticflickr.com/1/519/19282339528_2010ee2383.jpg" width="500" height="263" alt="mackerel-monitor_001"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></li>
<li>ポップアップしたウィンドウに監視条件を入力し作成ボタンをクリックします。<br>今回は不快指数(custom.room.1.discomfortindex)を選択し、77でWarning、80でCriticalとなるように設定します。<br><a data-flickr-embed="true" href="https://www.flickr.com/photos/130999506@N07/19463574002/in/dateposted-public/" title="mackerel-monitor_002" target="_blank" rel="external"><img src="https://c1.staticflickr.com/1/451/19463574002_2b9f7c24ee.jpg" width="500" height="263" alt="mackerel-monitor_002"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></li>
<li>作成した関し条件が一覧に表示されていれば成功です。<br>これで不快指数がしきい値を超えるた際にメール通知がされるようになりました。また、チャットなどメール以外の通知方法も用意されています。（私はHipChatにも通知しています。）<br><a data-flickr-embed="true" href="https://www.flickr.com/photos/130999506@N07/19463581282/in/dateposted-public/" title="momongar-discomfortindex" target="_blank" rel="external"><img src="https://c2.staticflickr.com/4/3912/19463581282_0628d1a7f6.jpg" width="500" height="260" alt="momongar-discomfortindex"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></li>
</ol>
<h1 id="ズゴックと連携する">ズゴックと連携する</h1><p>以前作成した、ズゴックXFDですが、<br>チームのみんながちゃんとテストが通ることを確認してからソースコードをPushするため、ほぼ活躍する機会がありません。<br>このままだと <strong>ただ職場にガンプラをおいている人になってしまう</strong> ので、<br>ズゴックの存在意義を上げるべく温度計を連携させたいと思います。</p>
<h2 id="温度計の実装">温度計の実装</h2><ol>
<li>ドリルで大まかな穴を開けた後、ニッパーで穴をつなぎ<br><a data-flickr-embed="true" href="https://www.flickr.com/photos/130999506@N07/18849417353/in/dateposted-public/" title="DSC_0093" target="_blank" rel="external"><img src="https://c1.staticflickr.com/1/546/18849417353_1ec27ef32a.jpg" width="500" height="281" alt="DSC_0093"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></li>
<li>カッターで凹凸を整えます<br><a data-flickr-embed="true" href="https://www.flickr.com/photos/130999506@N07/18849429613/in/dateposted-public/" title="DSC_0094" target="_blank" rel="external"><img src="https://c1.staticflickr.com/1/432/18849429613_180dececaf.jpg" width="500" height="281" alt="DSC_0094"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></li>
<li>温度計を開けた穴にはめ込み、配線を足経由で踵から外部に引き出せば完成です。<br><a data-flickr-embed="true" href="https://www.flickr.com/photos/130999506@N07/19443993586/in/dateposted-public/" title="DSC_0101" target="_blank" rel="external"><img src="https://c1.staticflickr.com/1/294/19443993586_0f60c72627.jpg" width="281" height="500" alt="DSC_0101"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></li>
<li>組み立てるとこんなかんじになります。<br><a data-flickr-embed="true" href="https://www.flickr.com/photos/130999506@N07/18849420843/in/dateposted-public/" title="DSC_0108" target="_blank" rel="external"><img src="https://c2.staticflickr.com/4/3707/18849420843_3bd5471118.jpg" width="500" height="281" alt="DSC_0108"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script><br><a data-flickr-embed="true" href="https://www.flickr.com/photos/130999506@N07/19443991026/in/dateposted-public/" title="DSC_0105" target="_blank" rel="external"><img src="https://c1.staticflickr.com/1/488/19443991026_6681b756d0.jpg" width="281" height="500" alt="DSC_0105"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></li>
</ol>
<h1 id="結果">結果</h1><p>晴れてズゴックに温度計が付き、職場の状況をモニタリングすることが可能になりました。</p>
<p>これで、自分の居室の不快指数を計測し放題です。<br>計測したところで、特に快適になったりはしないのは残念ですが、<br>計測データを元に現場のリーダーに職場環境のカイゼンをお願いする材料くらいにはなるはずです。</p>
<p>ただ、残念ながら、温度計を付けてもズゴック見た目に変化がないので、<br>相変わらず傍から見るとガンダム好きな人にしか見えないという点は今後の課題とします。</p>
<p>みなさんもMackerelと様々なセンサーを組み合わせて遊んでみるのはいかがでしょうか？</p>
<h1 id="参考URL">参考URL</h1><h2 id="Raspberry_Pi_の_I2C_を有効化する方法_(2015年版)">Raspberry Pi の I2C を有効化する方法 (2015年版)</h2><p><a href="https://blog.ymyzk.com/2015/02/enable-raspberry-pi-i2c/" target="_blank" rel="external">https://blog.ymyzk.com/2015/02/enable-raspberry-pi-i2c/</a></p>
<h2 id="Raspberry_Pi_で湿度センサ_AM2321_を使う">Raspberry Pi で湿度センサ AM2321 を使う</h2><p><a href="http://technology-memo.seesaa.net/article/404719464.html" target="_blank" rel="external">http://technology-memo.seesaa.net/article/404719464.html</a></p>
<h2 id="Mackerelについて">Mackerelについて</h2><p><a href="http://qiita.com/ariarijp/items/838628e121b051524309" target="_blank" rel="external">http://qiita.com/ariarijp/items/838628e121b051524309</a></p>
<h2 id="不快指数">不快指数</h2><p><a href="https://ja.wikipedia.org/wiki/%E4%B8%8D%E5%BF%AB%E6%8C%87%E6%95%B0" target="_blank" rel="external">https://ja.wikipedia.org/wiki/%E4%B8%8D%E5%BF%AB%E6%8C%87%E6%95%B0</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yenjoji.github.io/pages/pages/2015/07/14/mackerel-raspi-temp/" data-id="ciwuih0nj004000vxfiz0qz8y" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/pages/tags/IoT/">IoT</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/pages/tags/Mackerel/">Mackerel</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/pages/tags/RasperryPi/">RasperryPi</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/pages/tags/ネタ/">ネタ</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-20150621-spoken-at-asbc-tdd" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/pages/2015/06/22/20150621-spoken-at-asbc-tdd/" class="article-date">
  <time datetime="2015-06-21T16:03:35.000Z" itemprop="datePublished">2015-06-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/pages/2015/06/22/20150621-spoken-at-asbc-tdd/">2015/6/21 Agilesamurai Basecamp ふりかえり &amp; TDD でお話させていただきました。</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="https://agilesamurai-basecamp.doorkeeper.jp/events/25071" target="_blank" rel="external">Agile Samurai Basecamp 2015.06 ふりかえり&amp;TDD</a><br>の事例紹介セッションでお話をさせていただきました。</p>
<p>柴田さん (@hsbt)、末吉さん(@sue445) という豪華すぎるメンツに気後れしつつも無事に？発表出来ました。<br>基本一発ネタですが、スライドをアップしました。</p>
<h2 id="事例紹介_「安心してください。テスト書いてます」">事例紹介 「安心してください。テスト書いてます」</h2><p><iframe src="//www.slideshare.net/slideshow/embed_code/key/ibHSt7blkudEEl" width="425" height="355" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen> </iframe> <div style="margin-bottom:5px"> <strong> <a href="//www.slideshare.net/YasutoEnjoji/20150621-asbc-pub" title="20150621 Agilesamrai Basecamp TDD事例紹介" target="_blank">20150621 Agilesamrai Basecamp TDD事例紹介</a> </strong> from <strong><a href="//www.slideshare.net/YasutoEnjoji" target="_blank">Yasuto Enjoji</a></strong> </div></p>
<h2 id="QA">QA</h2><p>質疑応答で質問されたことを覚えている範囲で。</p>
<h3 id="良いテストコードを書くにはどうしたらいいか">良いテストコードを書くにはどうしたらいいか</h3><ul>
<li>（直接の回答では無いですが）実際にコードレビューとかしている時に感じた事は<ul>
<li>プロダクトコードの意図が汲み取れる様なテストだと嬉しいです。</li>
<li>単にカバレッジ等を稼ぐために量産した意図のわからないテストは嬉しくないです。</li>
</ul>
</li>
</ul>
<h3 id="Red_Green_Refactor_を守った場合と守らなかった場合で定量的な差はあるのか">Red Green Refactor を守った場合と守らなかった場合で定量的な差はあるのか</h3><ul>
<li>私達の現場では定量的に計測していないため、わかりません。</li>
</ul>
<h3 id="TDD導入するときに、既存チームからの暖簾分けする際のメンバーはどういう基準で選びましたか？">TDD導入するときに、既存チームからの暖簾分けする際のメンバーはどういう基準で選びましたか？</h3><ul>
<li>これが正解というのはないですが、私達のケースでは生きのいい技術が好きな若者を投入しました。<ul>
<li>自分からどんどんテストを書いて、周りを巻き込んでテストを書くという流れを作ってもらおうという意図でした。</li>
<li>チームメンバーもテストを書くことについては肯定的だったので、リズムを作ればうまくいくと考えてました。</li>
</ul>
</li>
</ul>
<h3 id="要求を満たしているかをTDDで担保するにはどうしたら良いか">要求を満たしているかをTDDで担保するにはどうしたら良いか</h3><ul>
<li>要求を満たしているかどうかはUnitテストでは担保できない（しにくい）と考えています。<ul>
<li>私の現場では、手動で行う結合テスト（受け入れテスト）が開発フロー上義務付けられているので、そこで担保できるようにしています。</li>
</ul>
</li>
</ul>
<p> 同じ現場で働いている @setoazusa さんからのキラーパスをうっかり受けてしまったことから始まった今回の登壇でしたが、<br> 豪華登壇者と並ばせていただくなど、本当に貴重な体験をさせていただきました。<br> こんな場を設けてくださったスタッフの皆様、超きれいな眺めのイイ会場を提供してくださったリクルートジョブズ様<br> 拙い話を最後まで聞いてくださった参加者の方々に感謝致します。<br> 有難う御座いました。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yenjoji.github.io/pages/pages/2015/06/22/20150621-spoken-at-asbc-tdd/" data-id="ciwuih0ju001x00vxxot3b1fo" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/pages/tags/Agile/">Agile</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-raspi-xfd" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/pages/2015/04/09/raspi-xfd/" class="article-date">
  <time datetime="2015-04-09T10:41:39.000Z" itemprop="datePublished">2015-04-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/pages/2015/04/09/raspi-xfd/">Raspberry Pi で XFD</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>突然ですがXFDをご存知ですか?</p>
<h1 id="XFDとは">XFDとは</h1><p>オブジェクト倶楽部 <a href="http://objectclub.jp/community/xfd/" target="_blank" rel="external">http://objectclub.jp/community/xfd/</a> によると</p>
<blockquote>
<p>プロジェクトステータスやメトリクスは、目に見えにくい。見えないからこそ難しい。そんな悩みを解決してくれるのが、XFD(eXtreme Feedback Device)です。目に見えて、楽しい、ユニークな装置。目に付いて、絶対見落とさないような装置を指します。安上がりならなおよろし。</p>
</blockquote>
<p>とのことです。</p>
<p>例えばCIによるビルドエラーに連動したパトランプ <a href="http://gitgear.com/xfd/" target="_blank" rel="external">http://gitgear.com/xfd/</a> など、<br>そのままだと気づきにくいイベントを気づきやすくするデバイスを指すようです。</p>
<h1 id="今回すること">今回すること</h1><p>今回はそんなXFDをRaspberry Piを利用して作成してみたいと思います。<br>なお、今回はAtlassian の CIサーバー Atlassian Bamboo を対象としますが、ビルド結果取得の部分だけ替えればJenkinsなどにも対応可能です。</p>
<h1 id="用意するもの">用意するもの</h1><ul>
<li><p>Raspberry Pi  x  1<br>今買うなら Raspberry Pi 2 Type B がお得だと思われます。</p>
</li>
<li><p>赤色LED x 1<br>色はお好みで。<br>今回はビルド失敗のエラー感を出すため 3mm径の赤色高輝度LEDとしました。</p>
</li>
<li><p>330Ω抵抗 x 1<br>LEDが壊れないよう基本に則って抵抗を使用します。</p>
</li>
<li><p>ブレットボード x 1</p>
</li>
<li>配線用ジャンパワイヤ　適量<br>その他配線用の機材を適宜用意します。</li>
</ul>
<h1 id="回路">回路</h1><p>上記のパーツを組み込むとこのようになります。</p>
<p><a href="https://www.flickr.com/photos/130999506@N07/17095952411" title="DSC_0078 by Yasuto Enjoji, on Flickr" target="_blank" rel="external"><img src="https://farm9.staticflickr.com/8793/17095952411_ae117f0b1c.jpg" width="500" height="281" alt="DSC_0078"></a></p>
<p>一応実体配線図も作ってみました</p>
<p><a href="https://www.flickr.com/photos/130999506@N07/16892826597" title="raspi-XFD by Yasuto Enjoji, on Flickr" target="_blank" rel="external"><img src="https://farm8.staticflickr.com/7680/16892826597_7816819f87.jpg" width="500" height="381" alt="raspi-XFD"></a></p>
<h1 id="プログラム">プログラム</h1><p>例えば以下のようにREST APIでBambooのビルド結果を取得します。<br>なお、今回はBamboo上に複数ブランチが登録されていることを前提としているため、ブランチがないと動きません。</p>
<script src="https://gist.github.com/yenjoji/f29553357d3a28566e7e.js"></script>

<h1 id="結果">結果</h1><p>これで、Bambooの指定したブランチがビルドエラーになった際には、<br>接続されたLEDが点灯するようになりました。</p>
<p><a href="https://www.flickr.com/photos/130999506@N07/16474189394" title="DSC_0079 by Yasuto Enjoji, on Flickr" target="_blank" rel="external"><img src="https://farm8.staticflickr.com/7685/16474189394_33deca6d01.jpg" width="500" height="281" alt="DSC_0079"></a></p>
<p>しかし、ちょっとこれでは寂しいので、ひと手間加えたいと思います。</p>
<p>最近はだいぶJOJOや、仮面ライダーに押されているとはいえ、エンジニアといえばガンダムです。</p>
<p>という訳で、ちょっとガンダムを足してみました。</p>
<p><a href="https://www.flickr.com/photos/130999506@N07/16909072210" title="DSC_0080 by Yasuto Enjoji, on Flickr" target="_blank" rel="external"><img src="https://farm8.staticflickr.com/7591/16909072210_ce02bdcf1f.jpg" width="500" height="281" alt="DSC_0080"></a></p>
<p>ドリルでモノアイ部分に穴を開けてLEDを装着し</p>
<p><a href="https://www.flickr.com/photos/130999506@N07/17145119535" title="DSC_0097 by Yasuto Enjoji, on Flickr" target="_blank" rel="external"><img src="https://farm8.staticflickr.com/7694/17145119535_53d2a4681f.jpg" width="500" height="281" alt="DSC_0097"></a></p>
<p>なるべく目立たないように配線をします。</p>
<p><a href="https://www.flickr.com/photos/130999506@N07/16522691594" title="DSC_0098 by Yasuto Enjoji, on Flickr" target="_blank" rel="external"><img src="https://farm9.staticflickr.com/8722/16522691594_c661070703.jpg" width="500" height="281" alt="DSC_0098"></a></p>
<p>最近のプラモはよく出来ていて、関節可動部分が多くいので<br>昔のプラモのように脚部の中がスカスカでなかったのは誤算でした。</p>
<p>今回はちょっと妥協してこのくらいにしておきますが、機会があればもう少し綺麗に配線をしたいと思います。</p>
<h1 id="動作例">動作例</h1><p>さて、再度どうなるか試してみます。</p>
<p>万が一Bambooでのビルドが失敗した場合には</p>
<p><a href="https://www.flickr.com/photos/130999506@N07/17110199341" title="bamboo_build_failed by Yasuto Enjoji, on Flickr" target="_blank" rel="external"><img src="https://farm9.staticflickr.com/8776/17110199341_93663d3018.jpg" width="500" height="331" alt="bamboo_build_failed"></a></p>
<p>光ります。</p>
<p><a href="https://www.flickr.com/photos/130999506@N07/16474189674" title="DSC_0084 by Yasuto Enjoji, on Flickr" target="_blank" rel="external"><img src="https://farm8.staticflickr.com/7626/16474189674_5dce3d4052.jpg" width="500" height="281" alt="DSC_0084"></a></p>
<p>これでだいぶ危機感が増しました。<br>ジムがやられる前になんとしてもビルドエラーを修正しなければなりません！！</p>
<h1 id="まとめ">まとめ</h1><p>Raspberry Piが発売されたことによって、ネットワークを利用した電子工作が簡単にできるようになりました。</p>
<p>電子工作初心者でも簡単に作れるオリジナルのXFDでプロジェクトを活性化して行きましょう！</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yenjoji.github.io/pages/pages/2015/04/09/raspi-xfd/" data-id="ciwuih0o1004d00vxtsz5l4ej" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/pages/tags/Agile/">Agile</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/pages/tags/IoT/">IoT</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/pages/tags/RasperryPi/">RasperryPi</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/pages/tags/ネタ/">ネタ</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2015-2-2-mpp" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/pages/2015/02/03/2015-2-2-mpp/" class="article-date">
  <time datetime="2015-02-02T18:35:00.000Z" itemprop="datePublished">2015-02-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/pages/2015/02/03/2015-2-2-mpp/">2015/2/2 英語学習勉強会「英語のセッションを聴く」実践編 に参加してきました。</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="https://www.flickr.com/photos/130999506@N07/16427800351" title="AXON_ACTIVE by Yasuto Enjoji, on Flickr" target="_blank" rel="external"><img src="https://farm8.staticflickr.com/7453/16427800351_48b521e76e_m.jpg" alt="AXON_ACTIVE"></a></p>
<p>牛尾さん(<a href="https://twitter.com/sandayuu" target="_blank" rel="external">https://twitter.com/sandayuu</a>)主催の、 Majide Perapera Project(<a href="http://mpp-group.doorkeeper.jp/" target="_blank" rel="external">http://mpp-group.doorkeeper.jp/</a>)の勉強会</p>
<p><strong>英語学習勉強会「英語のセッションを聴く」実践編</strong><br><a href="http://mpp-group.doorkeeper.jp/events/20267" target="_blank" rel="external">http://mpp-group.doorkeeper.jp/events/20267</a>に参加してきました。</p>
<p>オフショア開発の実践者であり、<br>牛尾さんをして「ガチアジャイルの実践者」と言わしめる程のMarkusさんの貴重な話を聞け、<br>更には、自分の質問も聞いてもらった上に、自分の理解力のなさを棚に上げた「Could you summarize it, please.」などという無茶なお願いにも<br>「もう、十分要約してあるんだけどなぁ」<br>とか言いつつも非常に丁寧に答えてもらえ、超実践的な英語の勉強にもなる大変有意義な勉強会でした。</p>
<h2 id="タイムテーブル">タイムテーブル</h2><p>19:30 - 19:45 Introduction<br> 19:45 - 20:30 My experience with IT outsourcing<br> 20:30 - 20:45 Team discussion<br> 20:45 - 21:30 Ask Mr. Markus</p>
<p>勉強会はこのような流れでした。（ただし、時間はなんとなくです。）</p>
<h3 id="1-_My_experience_with_IT_outsourcing">1. My experience with IT outsourcing</h3><p>まずは、ベトナムでのオフショア開発を実践されている<br> AXON ACTIVE 社(<a href="http://www.axonactive.vn/" target="_blank" rel="external">http://www.axonactive.vn/</a>)の<br> CEO Markus Baur さんによるオフショア開発の勘所と落とし穴に関するセッションです。</p>
<p>すべて英語のセッションだったため、けっこうな頻度で聞き取れないところがあったのが残念でしたが、それでも随所にためになるエッセンスが散りばめられていて非常に参考になりました。</p>
<ul>
<li>文化の違いを認識しなければならない<ul>
<li>インド人？のYesはYesじゃないとか</li>
</ul>
</li>
<li>アクセシビリティ<ul>
<li>オフショア先にいつでもすぐに飛んでいける距離感がとっても大切</li>
<li>時差は4時間ぐらいまでがいい</li>
</ul>
</li>
<li><p>Project型ではなくDedicated Team でないと難しい</p>
</li>
<li><p>短いスパンで頻繁な評価を</p>
</li>
<li>重厚なドキュメントを作らず、最低限のテキストで素早く結果を見る</li>
<li>チームサイズは 5-10 人 で7人くらいがいい</li>
<li><p>要求をまとめる人は一人にするべき</p>
</li>
<li><p>何を置いてもオフショアチームと直接会うべき</p>
<ul>
<li>最低限年に4回は現地にいくべき</li>
<li>現地で、一緒に話、ご飯を食べ、お酒を飲みましょう</li>
<li>お互いに歩み寄って、近い間柄になるべきです</li>
</ul>
</li>
</ul>
<h3 id="2-_Team_discussion">2. Team discussion</h3><p>次に、Markusさんの話を受けて、セッションの内容のチーム内での共有と<br> Markusさんに聞いてみたい質問をまとめるディスカッションタイムです。</p>
<p>質問のルールとして、チームディスカッションは日本語でOK、<br> 英語への翻訳もチームメンバーの力を借りてOKですが、</p>
<p>実際の質問は質問する人が、英語でMarkusさんに質問をするというルールでした。</p>
<h3 id="3-_Ask_Mr-Markus_(コーナー名は勝手につけました)">3. Ask Mr.Markus (コーナー名は勝手につけました)</h3><p>チームディスカッションの結果を元に、Markusさんを囲んで全員で座り、<br> Markusさんへ質問をぶつけて答えてもらおうのコーナーでした。<br> 当初は全員質問するのかなぁと思っていましたが、</p>
<p>個々の質問に対するMarkusさんの対応が丁寧、個々の話題が意外と盛り上がったこともあり、結局7,8件くらいの質問に答えてもらったところでタイムアップでした。</p>
<p>私は、ベトナムでは、けっこう転職が激しいという話も聞いたので、</p>
<p>「アジャイル開発において、チームメンバーが頻繁に入れ替わるのはよく無いと言われていますが、その問題にどう対応しますか？」<br> という質問を<br> 「Turn over of members is problem of Agile development. how do you<br>avoid risk.」<br> という英語で質問しました。<br> 回答は。<br> 1.<br>開発者に権限を与えて（強制的に働かせたりせず）自己組織化して働いてもらうこと。</p>
<ol>
<li>職場環境を整えて、（託児所を用意したりして）環境を良くすること<br>という回答を頂きました。</li>
</ol>
<p>ただ、そうは言っても文化の違いがあったりするので<br> （ベトナムは65％でOKとしてしまうらしいとか。）<br> 締めるべきところは締めてやっていかなければとも感じました。</p>
<h2 id="感想">感想</h2><p>オフショアバリバリやってる人の話をちょっと聞いてみようかなぁと<br>軽い気持ちで申し込んで。</p>
<p><blockquote class="twitter-tweet" lang="ja"><p>ちなみにさっきのフル英語講演ですよ :)</p>&mdash; TsuyoshiUshio (@sandayuu) <a href="https://twitter.com/sandayuu/status/561903951813963776" target="_blank" rel="external">2015, 2月 1</a></blockquote></p>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

<p>申し込んだ後にこのツイートに気づき、全編英語にビビりまくり</p>
<p>一瞬参加やめようかと思ったりもしましたが、参加して良かったと感じました。</p>
<p>一緒にディスカッションした方が、Markusさんの話を聞いて言った<br> 「これって日本でもおなじだよね」</p>
<p>といっていた言葉を聞いて、本質的なところは文化をこえるってことかなぁと一人感動したりしてました。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yenjoji.github.io/pages/pages/2015/02/03/2015-2-2-mpp/" data-id="ciwuih0kx001z00vxz9c1icjv" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/pages/tags/community/">community</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/pages/tags/english/">english</a></li></ul>

    </footer>
  </div>
  
</article>


  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/pages/page/3/">&laquo; Prev</a><a class="page-number" href="/pages/">1</a><a class="page-number" href="/pages/page/2/">2</a><a class="page-number" href="/pages/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/pages/page/5/">5</a><a class="page-number" href="/pages/page/6/">6</a><a class="page-number" href="/pages/page/7/">7</a><a class="extend next" rel="next" href="/pages/page/5/">Next &raquo;</a>
    </nav>
  
</section>
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      <a href="/pages/" class="logo">Rouleur</a>
      &copy; 2016 yenjoji<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    

<script src="/pages/js/jquery.min.js"></script>
<script src="/pages/js/jquery.scrollLoading.js"></script>


  <link rel="stylesheet" href="/pages/fancybox/jquery.fancybox.css">
  <script src="/pages/fancybox/jquery.fancybox.pack.js"></script>


<script src="/pages/js/script.js"></script>

  </div>
</body>
</html>